<?php

class ParticularController extends ApplicationController {

    public function indexAction(){
      $this->setResponse("ajax");
      echo parent::showTitle('Bienvenido a Mercurio');
    }

    public function consultaParticularAction(){
      echo parent::showTitle('Consulta de Estados de Afiliación'); 
      echo parent::showHelp('Esta opción le permite verificar en que estado se encuentra su proceso de afiliación.');
      $estado = array('A' => 'Aprobada', 'X' => 'Rechazada','P' => 'Pendiente');
      $mercurio30 = $this->Mercurio30->find('nit = "'.Session::getDATA('documento').'"');
      $response = "";
      $response .= "<h3 style='margin-left: 20px'>Afiliaciones Empresa</h3>";
      $response .= "<div style='margin: 15px auto; width: 95%; height: 150px; overflow: auto; padding: 10px;'>";
      $response .= "<table border='1' cellpadding='2' class='resultado-sec'>";
      $response .= "<thead>";
      $response .= "<tr class='tr-result'>";
      $response .= "<th>No.</th>";
      $response .= "<th>Nit</th>";
      $response .= "<th>Razon Social</th>";
      $response .= "<th>Estado</th>";
      $response .= "<th>Motivo</th>";
      $response .= "</tr>";
      $response .= "</thead>";
      $response .= "<tbody>";
      $x = 1;
      foreach ($mercurio30 as $mmercurio30) {
      	$response .= "<tr class='tr-res'>";
      	$response .= "<td>".$x++."</td>";
      	$response .= "<td>".Session::getDATA('documento')."</td>";
      	$response .= "<td>".$mmercurio30->getRazsoc()."</td>";
      	$response .= "<td>".$estado[$mmercurio30->getEstado()]."</td>";
      	$response .= "<td>".$mmercurio30->getMotivo()."</td>";
      	$response .= "</tr>";
      }
      if($x==1){
      	$response .= "<tr class='tr-res'>";
      	$response .= "<td colspan='5'>No tiene registros</td>";
      	$response .= "</tr>";
      }
      $response .= "</tbody>";
      $response .= "</table>";
      $response .= "</div>";
      $mercurio31 = $this->Mercurio31->find('cedtra = "'.Session::getDATA('documento').'"');
      $response .= "<h3 style='margin-left: 20px'>Afiliaciones Trabajador</h3>";
      $response .= "<div style='margin: 5px auto; width: 95%; height: 150px; overflow: auto; padding: 10px;'>";
      $response .= "<table border='1' cellpadding='2' class='resultado-sec'>";
      $response .= "<thead>";
      $response .= "<tr class='tr-result'>";
      $response .= "<th>No.</th>";
      $response .= "<th>Cedula</th>";
      $response .= "<th>Nombre</th>";
      $response .= "<th>Sexo</th>";
      $response .= "<th>Estado</th>";
      $response .= "<th>Motivo</th>";
      $response .= "</tr>";
      $response .= "</thead>";
      $response .= "<tbody>";
      $y = 1;
      foreach ($mercurio31 as $mmercurio31) {
      	$response .= "<tr class='tr-res'>";
      	$response .= "<td>".$y++."</td>";
      	$response .= "<td>".Session::getDATA('documento')."</td>";
      	$response .= "<td>".$mmercurio31->getPrinom().$mmercurio31->getSegnom().$mmercurio31->getPriape().$mmercurio31->getSegape()."</td>";
      	$response .= "<td>".$mmercurio31->getSexo()."</td>";
      	$response .= "<td>".$estado[$mmercurio31->getEstado()]."</td>";
      	$response .= "<td>".$mmercurio31->getMotivo()."</td>";
      	$response .= "</tr>";
      }
      if($y==1){
      	$response .= "<tr class='tr-res'>";
      	$response .= "<td colspan='6'>No tiene registros</td>";
      	$response .= "</tr>";
      } 
      $response .= "</tbody>";
      $response .= "</table>";
      $response .= "</div>";
      echo $response;
    }

    public function validaNitAction(){
      $this->setResponse('ajax');
      $nit = $this->getPostParam("nit");
      $empresa = parent::webService("autenticar",array('tipo' => 'E', 'cedtra' => $nit));
      $response = true;
      if($empresa != false){
        $response = false;
      }
      $this->renderText(json_encode($response));
    }
    public function digverAction(){
        $this->setResponse('ajax');
        $mnit = $this->getPostParam("nit");
        $arreglo = array(71,67,59,53,47,43,41,37,29,23,19,17,13,7,3);                    
        $nit = sprintf("%015s",$mnit);                                                   
        $suma = 0;                                                                       
        for($i=1;$i<=count($arreglo);$i++){                                              
            $suma += (int)(substr($nit,$i-1,1)) * $arreglo[$i-1];                         
        }                                                                                
        $retorno = $suma % 11;                                                           
        if($retorno >= 2) $retorno = 11 - $retorno;                                       
        $this->renderText(json_encode($retorno));
    }    

    public function consultaNitAction(){
      $this->setResponse('ajax');
      $nit = $this->getPostParam("nit");
      $empresa = parent::webService("autenticar",array('tipo' => 'E', 'cedtra' => $nit));
      $response = "";
      if($empresa != false){
        $razsoc = $empresa[0]['nombre'];
        $codact = $empresa[0]['codact'];
        $cod = substr($codact,0,2);
        $response = array('razsoc'=>$razsoc,'codact'=>$cod);
      }else{
          $response = false;
      }
      $this->renderText(json_encode($response));
    }

    public function consultaConyugeAction(){
      $this->setResponse('ajax');
      $cedcon = $this->getPostParam("cedcon");
      $conyuge = parent::webService("autenticar",array('tipo' => 'C', 'cedtra' => $cedcon));
      $response = false;
      if($conyuge != false){
        $response = $conyuge[0]['nombre'];
      }
      $this->renderText(json_encode($response));
    }
    
    
    public function addempresa_viewAction(){
      $this->setResponse("ajax");
      $codare = $this->getPostParam("codare");
      $codope = $this->getPostParam("codope");
      echo parent::showTitle('Afiliación como Empresa');
      Tag::displayTo("nit", SESSION::getDATA('documento'));
      echo parent::showHelp('Ingrese sus datos personas en cada uno de las campos visualizados en la parte de arriba de forma honesta para poder realizar enviar su afiliacion a la caja de compensacion.');
      $coddoc = parent::webService('tiposdocumentos',array());
      foreach($coddoc as $mcoddoc){
       
          $_coddoc[$mcoddoc['coddoc']] = $mcoddoc['detalle'];
      }
      $depart = parent::webService('departamento',array());
      foreach($depart as $mdepart ){
        $_depart[$mdepart['coddep']] = $mdepart['detalle'];
      }

      $codact = parent::webService('actividades',array());
      foreach($codact as $mcodact){
        $_codact[$mcodact['codact']] = $mcodact['codact']." - ".substr($mcodact['detalle'],0,90);
      } 
      $codzon = parent::webService('codigozona',array());
      foreach($codzon as $mcodzon){
        $_codzon[$mcodzon['codzon']] = $mcodzon['detzon'];
      }
      $tipsoc= parent::webservice('tipoSociedad',array());
      foreach($tipsoc as $mtipsoc){
          $_tipsoc[$mtipsoc['tipsoc']] = $mtipsoc['detalle'];
      }
      $codciu = parent::webservice('ciudades',array());
      foreach($codciu as $mcodciu){
        $_codciu[$mcodciu['codciu']] = $mcodciu['detalle'];
      }
      $this->setParamToView("coddoc", $_coddoc);
      $this->setParamToView("codciu", $_codciu);
      $this->setParamToView("coddep", $_depart);
      $this->setParamToView("codact", $_codact);
      $this->setParamToView("codare", $codare);
      $this->setParamToView("codope", $codope);
      $this->setParamToView("codzon", $_codzon);
      $this->setParamToView("tipsoc", $_tipsoc);
    }
      
    public function traerCiudadAction(){
        $this->setResponse("ajax");
        $coddep = $this->getPostParam("coddep");
        $codciu = parent::webService("ciudadesFiltradas",array("coddep"=>$coddep));
        
        if($codciu != false){
            $response = "<option value='@'>Seleccione...</option>";
            foreach($codciu as $ciudad)
                $response .= "<option value='$ciudad[codciu]'>$ciudad[detalle]</option>";
        }else{
            $response = false;
        }
        $this->renderText(json_encode($response));
    }    

    public function addempresa_reportAction(){
        $this->setResponse("ajax");
        $response = parent::startFunc();
        $file = "";
        $calemp = $this->getPostParam("calemp","addslaches","alpha","extraspaces","striptags");
        $nit = $this->getPostParam("nit","addslaches","numeric","extraspaces","striptags");
        /*$l = $this->Mercurio30->count("*","conditions: codcaj = '".Session::getDATA('codcaj')."' AND nit = '$nit' AND estado<>'X' ");

        if($l>0){
            $response = parent::errorFunc("Empresa Ya Envio Formulario");
            return $this->renderText(json_encode($response));
        }
        $result = parent::webService('autenticar',array("tipo"=>"E","cedtra"=>$nit));
        if($result!=false){
            $response = parent::errorFunc("Empresa Existe Afiliada");
            return $this->renderText(json_encode($response));
        }
        */

        if($calemp=='E') $file = self::reporte_empresa_e();
        if($calemp=='F' or $calemp=='P') $file = self::reporte_empresa_f();
        if($calemp=='D') $file = self::reporte_empresa_d();
        $response = parent::successFunc("Genera Formulario",$file);
        $this->renderText(json_encode($response)); 
    }

    public function reporte_empresa_e(){
        $nit = $this->getPostParam("nit","addslaches","numeric","extraspaces","striptags");
        $calemp = $this->getPostParam("calemp","addslaches","alpha","extraspaces","striptags");
        $razsoc = $this->getPostParam("razsoc","addslaches","alpha","extraspaces","striptags");
        $digver = $this->getPostParam("digver","addslaches","alpha","extraspaces","striptags");
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $codciu = $this->getPostParam("codciu","addslaches","alpha","extraspaces","striptags");
        $ciudad = parent::webService('nombreCiudad',array("codciu"=>$codciu));
        $codact = $this->getPostParam("codact","addslaches","alpha","extraspaces","striptags");
        $activi = parent::webService('actividad',array("codact"=>$codact));
        $autoriza= $this->getPostParam("autoriza","addslaches","alpha","extraspaces","striptags");
        $direccion = $this->getPostParam("direccion","addslaches","extraspaces","striptags");
        $telefono = $this->getPostParam("telefono","addslaches","alpha","extraspaces","striptags");
        $fax = $this->getPostParam("fax","addslaches","alpha","extraspaces","striptags");
        $email = $this->getPostParam("email","addslaches","extraspaces","striptags");
        $pagweb = $this->getPostParam("pagweb","addslaches","extraspaces","striptags");
        $feccon = $this->getPostParam("feccon","addslaches","extraspaces","striptags");
        $tottra = $this->getPostParam("tottra","addslaches","alpha","extraspaces","striptags");
        $totnom = $this->getPostParam("totnom","addslaches","alpha","extraspaces","striptags");
        $cedrep = $this->getPostParam("cedrep","addslaches","alpha","extraspaces","striptags");
        $pymes = $this->getPostParam("pymes","addslaches","alpha","extraspaces","striptags");
        $nomrep = $this->getPostParam("nomrep","addslaches","alpha","extraspaces","striptags");
        $tipemp = $this->getPostParam("tipemp","addslaches","alpha","extraspaces","striptags");
        $cedrep = $this->getPostParam("cedrep","addslaches","alpha","extraspaces","striptags");
        $tipsoc = $this->getPostParam("tipsoc","addslaches","alpha","extraspaces","striptags");
        $tipsoci = parent::webService('sociedad',array("tipsoc"=>$tipsoc));
        $coddocr = $this->getPostParam("coddocr","addslaches","alpha","extraspaces","striptags");
        $direccions = $this->getPostParam("direccions","addslaches","alpha","extraspaces","striptags");
        $codcius = $this->getPostParam("codcius","addslaches","alpha","extraspaces","striptags");
        $ciudads = parent::webService('nombreCiudad',array("codciu"=>$codcius));
        $telefonos = $this->getPostParam("telefonos","addslaches","alpha","extraspaces","striptags");
        $faxs = $this->getPostParam("faxs","addslaches","alpha","extraspaces","striptags");
        $emails = $this->getPostParam("emails","addslaches","extraspaces","striptags");
        $soceco= $this->getPostParam("soceco","addslaches","alpha","extraspaces","striptags");
        $nomsub= $this->getPostParam("nomsub","addslaches","alpha","extraspaces","striptags");
        $telsub= $this->getPostParam("telsub","addslaches","alpha","extraspaces","striptags");
        $emailsub= $this->getPostParam("emailsub","addslaches","extraspaces","striptags");
        $feccon = new Date($feccon);
        $today = new Date();
        $title = "Formulario Empresa";
        $formu = new FPDF('P','mm','A4');
        $formu->AddPage();
        $formu->SetTextColor(0);    
        $formu->SetAutoPageBreak(true,0.5);
        //$formu->SetY(2);
        $formu->Ln();
        $formu->SetFillColor(236,248,240);
        $formu->SetFont('Arial','','3.5');
        $formu->Image('public/img/logo-confaguajira.jpg',65,0,70,23);
        $formu->Image('public/img/LogoSuperSubsi.png',202,190,8,60);
        $formu->Image('public/img/Incontec1.jpg',15,15,12,17);
        $formu->Image('public/img/Incontec2.jpg',30,18,13,12);
        $formu->setX(10);
        $formu->SetTextColor(8,32,112);
        $formu->Cell(0,20,"",0,1,0,0,0);
        $formu->Cell(45,5,"        Certificado N. SC 5146-1",0,0,"L",0,0);
        $formu->SetTextColor(80,177,116);
        $formu->SetFont('Arial','B','10');
        $formu->Cell(70,5,UTF8_DECODE("SOLICITUD DE AFILIACIÓN"),0,0,"R",0,0);
        $formu->SetFont('Arial','','9');
        $formu->SetTextColor(0);
        $formu->Cell(25,4,UTF8_DECODE("Año"),"LTR",0,"L",1,0);
        $formu->Cell(25,4,"Mes","LRT",0,"L",1,0);
        $formu->Cell(25,4,UTF8_DECODE("Día"),"LRT",1,"L",1,0);
        $formu->SetTextColor(80,177,116);
        $formu->SetFont('Arial','B','10');
        $formu->Cell(115,5,"Y NOVEDADES DE EMPRESAS",0,0,"R",0,0);
        $formu->SetTextColor(0);
        $formu->SetFont('Arial','','9');
        $formu->Cell(25,4,$today->getYear(),"LRB",0,"C",0,0);
        $formu->Cell(25,4,$today->getMonth(),"LRB",0,"C",0,0);
        $formu->Cell(25,4,$today->getday(),"LRB",1,"C",0,0);
        $formu->Ln();
        $formu->setX(10);
        $formu->SetFont('Arial','B','9');
        $formu->Cell(190,1,"","LRT",1,0,1,0);
        $formu->Cell(80,4,UTF8_DECODE("I. AFILIACIÓN DE EMPRESA"),"L",0,"C",1,0);
        $formu->Cell(5,4,"X",1,0,0,0,0);
        $formu->Cell(80,4,UTF8_DECODE("II. ACTIVACIÓN"),0,0,"C",1,0);
        $formu->Cell(5,4,"",1,0,"L",0,0);
        $formu->Cell(20,4,"","R",1,"R",1,0);
        $formu->Cell(190,1,"","LRB",1,0,1,0);
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','7');
        $formu->Cell(30,3,"  RAZON SOCIAL","LT",0,"L",1,0);
        $formu->SetFont('Arial','B','5.5');
        $formu->Cell(70,3,"(COMO APARECE EN EL CERTIFICADO DE EXISTENCIA NO SE ACEPTAN SIGLAS)","RT",0,0,1,0);
        $formu->SetFont('Arial','B','7');
        $formu->Cell(40,3,"  NIT.:","LT",0,"L",1,0);
        $formu->Cell(27,3,"  PRINCIPAL","LT",0,"L",1,0);
        $formu->Cell(23,3,"  SUCURSAL","RT",1,"L",1,0);
        while(($formu->GetStringWidth($razsoc)-95)>0) 
        $razsoc = substr($razsoc,0,strlen($razsoc)-4)."...";
        $formu->Cell(100,4,$razsoc,"LR",0,"L",0,0);
        $formu->Cell(40,4,$nit,"LR",0,"C",0,0);
        $formu->Cell(18,4,"","L",0,0,0,0);
        $a="";
        $b="";
        if($soceco=='P')$a='X';
        if($soceco=='S')$b='X';
        $formu->Cell(3,3,$a,1,0,0,0,0);
        $formu->Cell(24,4,"",0,0,0,0,0);
        $formu->Cell(3,3,$b,1,0,0,0,0);
        $formu->Cell(2,4,"","R",1,0,0,0);
        $formu->Cell(100,4,UTF8_DECODE("DIRECCION PARA ENVIO DE CORRESPONDENCIA"),"LRT",0,"L",1,0);
        $formu->Cell(50,4," CIUDAD","LRT",0,"L",1,0);
        $formu->Cell(40,4," TELEFONO","LRT",1,"L",1,0);
        while(($formu->GetStringWidth($direccion)-95)>0) 
        $direccion = substr($direccion,0,strlen($direccion)-4)."...";
        $formu->Cell(100,4,$direccion,"LRB",0,"C",0,0);
        $formu->Cell(50,4,$ciudad[0]['detciu'],"LRB",0,"C",0,0);
        $formu->Cell(40,4,$telefono,"LRB",1,"C",0,0);
        $formu->Cell(55,4,"  FAX","LRT",0,"L",1,0);
        $formu->Cell(135,4," E: MAIL","LRT",1,"L",1,0);
        $formu->Cell(55,4,$fax,"LRB",0,"C",0,0);
        $formu->Cell(135,4,$email,"LRB",1,"C",0,0);
        $formu->Cell(100,4,"DIRECCION OFICINA SUCURSAL","LRT",0,"L",1,0);
        $formu->Cell(45,4,"CIUDAD","LRT",0,"L",1,0);
        $formu->Cell(45,4,"TELEFONO","LRT",1,"L",1,0);
        $formu->Cell(100,4,$direccions,"LRB",0,"C",0,0);
        $formu->Cell(45,4,$ciudads[0]['detciu'],"LRB",0,"L",0,0);
        $formu->Cell(45,4,$telefonos,"LRB",1,"L",0,0);
        $formu->Cell(95,4,"FAX","LRT",0,"L",1,0);
        $formu->Cell(95,4,"E: MAIL","LRT",1,"L",1,0);
        $formu->Cell(95,4,$faxs,"LRB",0,"L",0,0);
        $formu->Cell(95,4,$emails,"LRB",1,"L",0,0);
        $formu->Cell(143,4,"CODIGO ACTIVIDAD ECONOMICA","LT",0,"L",1,0);
        $formu->SetFont('Arial','B','5.5');
        $formu->Cell(47,4,"(LA QUE APARECE EN EL RUT DE LA DIAN)","RT",1,"L",1,0);
        $formu->SetFont('Arial','B','7');
        $formu->Cell(190,4,subStr($codact."  -  ".$activi[0]['detalle'],0,55),"LRB",1,"L",0,0);
        $formu->Cell(130,4,"CLASE DE EMPRESA (UNICAMENTE COMO APARECE EN EL CERTIFICADO DE EXISTENCIA)","LRT",0,"L",1,0);
        $formu->Cell(60,4," MIPYMES ","LRT",1,"L",1,0);
        $a="";
        $b="";
        $c="";
        if($tipemp=="O")$a="X";
        if($tipemp=="P")$b="X";
        if($tipemp=="M")$c="X";
        $formu->Cell(20,4,"OFICIAL","L",0,"C",0,0);
        $formu->Cell(3,3,$a,1,0,"L",0,0);
        $formu->Cell(20,4,"PRIVADA",0,0,"C",0,0);
        $formu->Cell(3,3,$b,1,0,"L",0,0);
        $formu->Cell(20,4,"MIXTA",0,0,"C",0,0);
        $formu->Cell(3,3,$c,1,0,"L",0,0);
        $formu->Cell(25,4,"OTRA CUAL?",0,0,"R",0,0);
        $formu->Cell(36,4,"","R",0,"L",0,0);
        $a="";
        $b="";
        if($pymes=="S")$a="X";
        if($pymes=="N")$b="X";
        $formu->Cell(20,4," SI ",0,0,"C",0,0);
        $formu->Cell(3,3,$a,1,0,"L",0,0);
        $formu->Cell(20,4," NO ",0,0,"C",0,0);
        $formu->Cell(3,3,$b,1,0,"L",0,0);
        $formu->Cell(14,4,"","R",1,"L",0,0);
        $formu->Cell(0,1,"","LRB",1,0,0,0);
        $formu->Cell(0,4,"TIPO DE EMPRESA","LRT",1,"L",1,0);
        $formu->Cell(0,1,"","LR",1,"L",0,0);
        $e="";
        $f="";
        $g="";
        $h="";
        $i="";
        $j="";
        $k="";
        $l="";
        $m="";
        $n="";
        $o="";
        $p="";
        $q="";
        $r="";
        $s="";
        $t="";
        switch($tipsoc){
            case '00':
                $e="X";
                break;
            case '01':
                $f="X";
                break;
            case '12':
                $g="X";
                break;
            case '03':
                $h="X";
                break;
            case '04':
                $i="X";
                break;
            case '07':
                $j="X";
                break;
            case '24':
                $k="X";
                break;
            case '13':
                $l="X";
                break;
            case '19':
                $m="X";
                break;
            case '06':
                $n="X";
                break;
            case '18':
                $o="X";
                break;
            case '14':
                $p="X";
                break;
            case '16':
                $q="X";
                break;
            case '22':
                $r="X";
                break;
            case '15':
                $s="X";
                break;
            default:
                $t="X";
                break;
        } 
        $formu->Cell(25,4,"1. LIMITADA","L",0,"L",0,0);
        $formu->Cell(3,3,$f,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(25,4,"2. ANONIMA","L",0,"L",0,0);
        $formu->Cell(3,3,$g,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(35,4,"3. EN  COMANDITA SIMPLE","L",0,"L",0,0);
        $formu->Cell(3,3,$h,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(45,4,"4. ENCOMANDITA POR ACCIONES","L",0,"L",0,0);
        $formu->Cell(3,3,$i,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(30,4,"5. UNI PERSONAL","L",0,"L",0,0);
        $formu->Cell(3,3,$j,1,0,"L",0,0);
        $formu->Cell(3,4,"","R",1,"L",0,0);
        $formu->Cell(31,2,"","L",0,"L",0,0);
        $formu->Cell(31,2,"","L",0,"L",0,0);
        $formu->Cell(41,2,"","L",0,"L",0,0);
        $formu->Cell(51,2,"","L",0,"L",0,0);
        $formu->Cell(36,2,"","LR",1,"L",0,0);
        $formu->Cell(25,4,"6. COLECTIVA","L",0,"L",0,0);
        $formu->Cell(3,3,$k,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(25,4,"7. DE HECHO","L",0,"L",0,0);
        $formu->Cell(3,3,$l,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(35,4,"8. ECONOMIA MIXTA","L",0,"L",0,0);
        $formu->Cell(3,3,$m,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(45,4,"9. PERSONA NATURAL","L",0,"L",0,0);
        $formu->Cell(3,3,$n,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(30,4,"10. S.A.S","L",0,"L",0,0);
        $formu->Cell(3,3,$o,1,0,"L",0,0);
        $formu->Cell(3,4,"","R",1,"L",0,0);
        $formu->Cell(31,2,"","L",0,"L",0,0);
        $formu->Cell(31,2,"","L",0,"L",0,0);
        $formu->Cell(41,2,"","L",0,"L",0,0);
        $formu->Cell(51,2,"","L",0,"L",0,0);
        $formu->Cell(36,2,"","LR",1,"L",0,0);
        $formu->Cell(25,4,"11. CONSORCIO","L",0,"L",0,0);
        $formu->Cell(3,3,$p,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(25,4,"12. U.T","L",0,"L",0,0);
        $formu->Cell(3,3,$q,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(35,4,"13. ONG","L",0,"L",0,0);
        $formu->Cell(3,3,$r,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(45,4,"14. COOPERATIVAS","L",0,"L",0,0);
        $formu->Cell(3,3,$s,1,0,"L",0,0);
        $formu->Cell(3,3,"",0,0,"L",0,0);
        $formu->Cell(30,4,"OTRA CUAL ?","L",0,"L",0,0);
        $formu->Cell(3,3,$t,1,0,"L",0,0);
        $formu->Cell(3,4,"","R",1,"L",0,0);
        $formu->Cell(190,2,"","LBR",1,0,0,0);
        $formu->Cell(190,3,UTF8_DECODE("¿CUAL?"),"TLR",1,"L",1,0);
        if($f=="X"||$g=="X"||$h=="X"||$i=="X"||$j=="X"||$k=="X"||$l=="X"||$m=="X"||$n=="X"||$o=="X"||$p=="X"||$q=="X"||$s=="X"||$r=="X"||$t=="X"){
        $formu->Cell(190,4,"","LBR",1,"C",0,0);
        }else{
        $formu->Cell(190,4,$tipsoci[0]['detalle'],"LBR",1,"C",0,0);
        }
        $formu->SetFont('Arial','','9');
        $formu->Cell(28,3," Mes de cotizacion.   ","TLR",0,"L",1,0);
        $formu->SetFont('Arial','','7');
        $formu->Cell(162,3," ( Fecha de la cual va a cancelar el aporte)  ","TR",1,"L",1,0);
        $formu->SetFont('Arial','','8');
        $formu->Cell(50,4,"Periodo : ","L",0,"L",0,0);
        $formu->Cell(140,4,"","R",1,"C",0,0);
        $formu->Cell(190,2,"","LBR",1,"C",0,0);
        $formu->SetTextColor(80,177,116);
        $formu->SetFont('Arial','B','10');
        $formu->Cell(0,8,"DATOS DEL PRESENTE LEGAL",0,1,"L",0,0);
        $formu->SetTextColor(0,0,0);
        $formu->SetFont('Arial','B','7');
        $formu->Cell(0,3,"    NOMBRES Y APELLIDOS", "LRT",1,"L",1,0);
        $formu->Cell(0,3,$nomrep,"LRB",1,"C",0,0);
        $formu->Cell(95,3,UTF8_DECODE("    TIPO DE IDENTIFICACIÓN"),"LRT",0,"L",1,0);
        $formu->Cell(95,3,UTF8_DECODE("    NUMERO DE IDENTIFICACIÓN"), "LRT",1,"L",1,0);
        $formu->Cell(39,3,"", "L",0,"L",0,0);
        $a="";
        $b="";
        $c="";
        $d="";
        if($coddocr=="T")$a="X";
        if($coddocr=="C")$b="X";
        if($coddocr=="E")$c="X";
        if($coddocr=="P")$d="X";
        $formu->Cell(9,4,"T.I", "",0,"R",0,0);
        $formu->Cell(3,3,$a, 1,0,"L",0,0);
        $formu->Cell(9,4,"C.C ", "",0,"R",0,0);
        $formu->Cell(3,3,$b, 1,0,"L",0,0);
        $formu->Cell(9,4,"C.E", "",0,"R",0,0);
        $formu->Cell(3,3,$c, "LBRT",0,"L",0,0);
        $formu->Cell(9,3,"P.P", "",0,"R",0,0);
        $formu->Cell(3,3,$d, "RTLB",0,"L",0,0);
        $formu->Cell(8,4,"", "R",0,"L",0,0);
        $formu->Cell(95,4,$cedrep,"LR",1,"C",0,0);
        $formu->Cell(50,3,"PERSONA QUE COORDINA EL SUBSIDIO", "LT",0,"L",1,0);
        $formu->SetFont('Arial','','6');
        $formu->Cell(60,3,"(CAMPO OBLIGATORIO)", "RT",0,"L",1,0);
        $formu->SetFont('Arial','B','7');
        $formu->Cell(40,3,UTF8_DECODE("TELÉFONO"), "LRT",0,"L",1,0);
        $formu->Cell(40,3,"E-mail", "LRT",1,"L",1,0);
        $formu->Cell(110,4,$nomsub, "LRB",0,"C",0,0);
        $formu->Cell(40,4,$telsub, "LRB",0,"C",0,0);
        $formu->Cell(40,4,$emailsub, "LRB",1,"C",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','','7.9');
        $formu->Cell(0,3,UTF8_DECODE("Autorizo a Comfaguajira  a utilizar los datos aquí registrados para que sean tratados de manera confidencial, segura, leal y transparente en los términos y"),"",1,"L",0,0);
        $formu->SetFont('Arial','','7.7');
        $formu->Cell (0,3,UTF8_DECODE("condiciones señalado en la Ley 1581 y 2012 y el decreto 1377 de 2013, para el desarrollo de campanas promocionales, ofertas de servicios y progamas de"),"",1,"L",0,0);
        $formu->SetFont('Arial','','7.9');
        $formu->Cell(128,3,UTF8_DECODE("fidelizacion diseñadas, implementadas y administradas por COMFAGUIAJIRA o terceros autorizados,"),"",0,"L",0,0);
        $formu->SetFont('Arial','','8.5');
        $s="";
        $t="";
        if($autoriza=="S")$e="X";
        if($autoriza=="N")$h="X";
        $formu->Cell(40,4,"SI_".$e."_ NO_".$h."_","",1,"L",0,0);
        $formu->SetFont('Arial','B','6.5');
        $formu->Cell(0,4,"BAJO GRAVEDAD DE JURAMENTO DECLARO QUE LOS DATOS CONSIGNADOS EN ESTE FORMATO REFLEJAN LA REALIDAD DE LA EMPRESA POR MI REPRESENTADA.","",1,"L",0,0);
        $formu->Ln();
        $formu->SetFont('Arial','B','7');
        $formu->Cell(50,4,"Representante de la Empresa","LRT",0,"C",0,0);
        $formu->Cell(20,4,"","",0,"C",0,0);
        $formu->Cell(50,4,"Recibo responsable de afiliaciones","LRT",0,"C",0,0);
        $formu->Cell(20,4,"","",0,"C",0,0);
        $formu->Cell(50,4,UTF8_DECODE("Recibo sección de aportes"),"LRT",1,"C",0,0);
        $formu->Cell(50,8,"","LR",0,"C",0,0);
        $formu->Cell(20,8,"","",0,"C",0,0);
        $formu->Cell(50,8,"","LR",0,"C",0,0);
        $formu->Cell(20,8,"","",0,"C",0,0);
        $formu->Cell(50,8,"","LR",1,"C",0,0);
        $formu->Cell(5,4,"","L",0,"C",0,0);
        $formu->Cell(40,4,"Firma y sello de la Empresa","T",0,"C",0,0);
        $formu->Cell(5,4,"","R",0,"C",0,0);
        $formu->Cell(20,4,"","",0,"C",0,0);
        $formu->Cell(5,4,"","L",0,"C",0,0);
        $formu->Cell(40,4,"Firma y sello de la Empresa","T",0,"C",0,0);
        $formu->Cell(5,4,"","R",0,"C",0,0);
        $formu->Cell(20,4,"","",0,"C",0,0);
        $formu->Cell(5,4,"","L",0,"C",0,0);
        $formu->Cell(40,4,"Firma y sello de la Empresa","T",0,"C",0,0);
        $formu->Cell(5,4,"","R",1,"C",0,0);
        $formu->Cell(50,2,"","LRB",0,"C",0,0);
        $formu->Cell(20,2,"","",0,"C",0,0);
        $formu->Cell(50,2,"","LRB",0,"C",0,0);
        $formu->Cell(20,2,"","",0,"C",0,0);
        $formu->Cell(50,2,"","LRB",1,"C",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','8');
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(0,2,"","LRT",1,"L",0,0);
        $formu->Cell(5,4,"","L",0,"L",0,0);
        $formu->Cell(80,4,"PARA USO EXCLUSIVO DE APORTES Y SUBSIDIOS","",0,"L",0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(10,4,"","R",0,"L",0,0);
        $formu->Cell(10,4,"","",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(85,4,"OBSERVACIONES","R",1,"L",0,0);
        $formu->SetFont('Arial','','7');
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,UTF8_DECODE("Certificado de Representación legal o documento equivalente"),0,0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,5,"","B",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(5,3,"","L",0,0,0,0);
        $formu->Cell(80,3,UTF8_DECODE("Relación de trabajadores o nomina armada por el presente legal"),"",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,3,"","R",0,0,0,0);
        $formu->Cell(5,3,"","",0,0,0,0);
        $formu->Cell(85,7,"","B",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,3,"","R",1,0,0,0);
        $formu->Cell(5,3,"","L",0,0,0,0);
        $formu->Cell(80,3,"  o contador","",0,"L",0,0);
        $formu->Cell(3,3,"","",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,3,"","R",0,0,0,0);
        $formu->Cell(5,3,"","",0,0,0,0);
        $formu->Cell(85,3,"","",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,3,"","R",1,0,0,0);
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,UTF8_DECODE("Paz y salvo de afiliación anterior a una Caja de Compensación"),"",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,7,"","B",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(5,2,"","L",0,0,0,0);
        $formu->Cell(80,2,"dentro del Departamento de la Guajira","",0,"L",0,0);
        $formu->Cell(3,2,"","",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,2,"","R",0,0,0,0);
        $formu->Cell(5,2,"","",0,0,0,0);
        $formu->Cell(85,2,"","",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,2,"","R",1,0,0,0);
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,UTF8_DECODE("Oficio de solicitud de afiliación"),"",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,7,"","B",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,"Fotocopia de la cedula cuando es persona natural","",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,9,"","B",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,UTF8_DECODE("Carta de aceptación"),"",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,11,"","B",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,UTF8_DECODE("Manifestación de acogerse o no a la ley 1429, en caso de mipyme"),"",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,5,"","",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(5,4,"","L",0,0,0,0);
        $formu->Cell(80,4,"Estatutos (caso de las cooperativas y pre-cooperativas)","",0,"L",0,0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(7,4,"","R",0,0,0,0);
        $formu->Cell(5,4,"","",0,0,0,0);
        $formu->Cell(85,5,"","",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(5,4,"","R",1,0,0,0);
        $formu->Cell(0,2,"","LRB",1,0,0,0);
        $formu->Ln();
        $formu->Cell(0,4,UTF8_DECODE("CAUSALES DE RECHAZO O DEVOLUCIÓN DE LA AFILIACIÓN"),0,1,"L",0,0);
        $formu->Cell(0,4,UTF8_DECODE("*Que los Documentos no estén completos."),0,1,"L",0,0);
        $formu->Cell(0,4,UTF8_DECODE("*Que no estén legibles, con tachones, corrector y/o enmendaduras."),0,1,"L",0,0);
        $formu->Cell(150,4,"*Que no este totalmente diligenciado.",0,0,"L",0,0);
        $formu->SetTextColor(80,177,116);
        $formu->SetFont('Arial','B',8);
        $formu->Cell(40,4,"SM-FO-VOO8 VERSION",0,1,"L",0,0);
        $formu->SetFont('Arial','',8);
        $formu->SetTextColor(0);
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->AddPage();
        $formu->SetMargins(20,10,17);
        $formu->SetFont('Arial','B','15');
        $formu->Cell(0,6,"INSTRUCCIONES PARA EL DILIGENCIAMIENTO.",0,1,"C",0,0);
        $formu->Ln();
        $formu->SetFont('Arial','','11.5');
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("1.-    POR NOMINA DEBE ENTENDERSE LA TOTALIDAD DE PAGOS POR CONCEPTOS \n DE LOS DIFERENTES ELEMENTOS INTEGRANTES DEL SALARIO COMO SON: \n JORNALES, SUELDOS, SOBRESUELDOS, HORAS EXTRAS, PORCENTAJES \n O COMISIONES SOBRE VENTAS, PARTICIPACIÓN EN UTILIDADES, SALARIO \n EN ESPECIE, VIÁTICOS (EN LO DESTINADO A MANUTENCIÓN Y ALOJAMIENTO) \n BONIFICACIONES HABITUALES, PRIMAS EXTRALEGALES DE SERVICIO, DESCANSO."),"","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"2.-    DEBE INCLUIRSE TODO EL PERSONAL: OBREROS, EMPLEADOS Y DIRECTIVOS.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("3.-    TRABAJADORES CON SUBSIDIO: TIENEN DERECHO A SUBSIDIO LOS \n TRABAJADORES PERMANENTES, CON PERSONAS A CARGO, CUYA REMUNERACIÓN\n  MENSUAL NO SOBREPASE LOS (4) SALARIOS MÍNIMOS Y QUE LABOREN POR LO\n MENOS 96 HORAS AL MES."),"","L",0);
        $formu->Ln();
        $formu->Cell(0,5,"4.-    LOS   HIJOS    CAUSAN    DERECHO   AL   SUBSIDIO    CUANDO    DEPENDEN",0,1,"L",0,0);
        $formu->Cell(0,5,UTF8_DECODE("ECONÓMICAMENTE DEL TRABAJADOR Y CONVIVAN CON EL, ENTRE LOS 12 Y 18"),0,1,"L",0,0);
        $formu->Cell(0,5,UTF8_DECODE("AÑOS DEBEN ACREDITAR ESCOLARIDAD."),0,1,"L",0,0);
        $formu->Ln();
        $formu->MultiCell(0,5,"5.-    TRABAJADORES SIN SUBSIDIO: SON LOS QUE NO TIENEN DERECHO A SUBSIDIO \nMONETARIO POR NO CUMPLIR LOS REQUISITOS DEL NUMERAL 3.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("6.- EN CASO DE CESE DE ACTIVIDADES O CIERRE DEL ESTABLECIMIENTO, DEBE \nPRESENTAR UN OFICIO SOLICITANDO EL RETIRO DE LA EMPRESA, INDICANDO LA \nFECHA Y EL MOTIVO, NO RETIRAR LA EMPRESA GENERA MORA EN EL PAGO DE LOS \nAPORTES Y PODRÁ SER EXPULSADO DE LA CAJA, ART. 45 LEY 21 DE 1982."),"","L",0);
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','14');
        $formu->Cell(0,6,"DOCUMENTOS ANEXOS A LA SOLICITUD",0,1,"C",0,0);
        $formu->SetFont('Arial','','11.5');
        $formu->Ln();
        $formu->Cell(0,5,UTF8_DECODE("1.-    COMUNICACIÓN        ESCRITA     DIRIGIDA     A   LA    RESPECTIVA      CAJA     DE "),0,1,"L",0,0);
        $formu->Cell(0,5,UTF8_DECODE("COMPENSACIÓN    FAMILIAR,  EN   LA   QUE   INFORME:   NOMBRE  DEL  EMPLEADOR,"),0,1,"L",0,0);
        $formu->Cell(0,5,UTF8_DECODE("DOMICILIO,      IDENTIFICACIÓN,  LUGAR  DONDE    SE    CAUSEN   LOS  SALARIOS   Y"),0,1,"L",0,0);
        $formu->Cell(0,5,UTF8_DECODE("MANIFESTACIÓN    SOBRE    SI    ESTABA    O   NO  AFILIADO    A   ALGUNA   CAJA   DE"),0,1,"L",0,0);
        $formu->Cell(0,5,UTF8_DECODE("COMPENSACIÓN FAMILIAR."),0,1,"L",0,0);
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("2.- PRUEBA  DE  LA  EXISTENCIA  Y  REPRESENTACIÓN  LEGAL  TRATÁNDOSE  DE\n PERSONA  JURÍDICA.  EN  CASO  DE  LAS  PERSONAS  NATURALES BASTARA  LA\n PRESENTACION  DE  FOTOCOPIA  DE  LA  CEDULA  DE  CIUDADANÍA."),"","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("3.- CERTIFICADO DE PAZ Y SALVO EN EL CASO DE AFILIACIÓN ANTERIOR A OTRA\n CAJA DENTRO DEL DEPARTAMENTO DE LA GUAJIRA."),"","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("4.- RELACIÓN DE TRABAJADORES Y SALARIOS O NOMINA, FIRMADA POR EL \nCONTADOR PUBLICO O REPRESENTANTE LEGAL."),"","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,UTF8_DECODE("5.- MANIFESTACIÓN DE ACOGERSE O NO A LA LEY 1429, EN CASO DE LAS MIPYME."),"","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"LA SOLICITUD SE RADICARA POR LA RESPECTIVA CAJA.","","L",0);
        $this->setResponse('view');
        $file = "public/temp/reportes/empresa_$nit.pdf";
        ob_clean();
        $formu->Output( $file,"F");
        return $file;
    }

    public function reporte_empresa_d(){
    
        $nit = $this->getPostParam("nit","addslaches","numeric","extraspaces","striptags");
        $calemp = $this->getPostParam("calemp","addslaches","alpha","extraspaces","striptags");
        $razsoc = $this->getPostParam("razsoc","addslaches","alpha","extraspaces","striptags");
        $digver = $this->getPostParam("digver","addslaches","alpha","extraspaces","striptags");
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $codciu = $this->getPostParam("codciu","addslaches","alpha","extraspaces","striptags");
        $ciudad = parent::webService('nombreCiudad',array("codciu"=>$codciu));
        $codact = $this->getPostParam("codact","addslaches","alpha","extraspaces","striptags");
        $activi = parent::webService('actividad',array("codact"=>$codact));
        $autoriza= $this->getPostParam("autoriza","addslaches","alpha","extraspaces","striptags");
        $direccion = $this->getPostParam("direccion","addslaches","extraspaces","striptags");
        $telefono = $this->getPostParam("telefono","addslaches","alpha","extraspaces","striptags");
        $fax = $this->getPostParam("fax","addslaches","alpha","extraspaces","striptags");
        $email = $this->getPostParam("email","addslaches","extraspaces","striptags");
        $pagweb = $this->getPostParam("pagweb","addslaches","extraspaces","striptags");
        $feccon = $this->getPostParam("feccon","addslaches","extraspaces","striptags");
        $tottra = $this->getPostParam("tottra","addslaches","alpha","extraspaces","striptags");
        $totnom = $this->getPostParam("totnom","addslaches","alpha","extraspaces","striptags");
        $cedrep = $this->getPostParam("cedrep","addslaches","alpha","extraspaces","striptags");
        $pymes = $this->getPostParam("pymes","addslaches","alpha","extraspaces","striptags");
        $nomrep = $this->getPostParam("nomrep","addslaches","alpha","extraspaces","striptags");
        $tipemp = $this->getPostParam("tipemp","addslaches","alpha","extraspaces","striptags");
        $calemp = $this->getPostParam("cedrep","addslaches","alpha","extraspaces","striptags");
        $tipsoc = $this->getPostParam("tipsoc","addslaches","alpha","extraspaces","striptags");
        $tipsoci = parent::webService('sociedad',array("tipsoc"=>$tipsoc));
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $direccions = $this->getPostParam("direccions","addslaches","alpha","extraspaces","striptags");
        $codcius = $this->getPostParam("codcius","addslaches","alpha","extraspaces","striptags");
        $ciudads = parent::webService('nombreCiudad',array("codciu"=>$codcius));
        $telefonos = $this->getPostParam("telefonos","addslaches","alpha","extraspaces","striptags");
        $faxs = $this->getPostParam("faxs","addslaches","alpha","extraspaces","striptags");
        $emails = $this->getPostParam("emailsub","addslaches","extraspaces","striptags");
        $soceco= $this->getPostParam("soceco","addslaches","alpha","extraspaces","striptags");

        $today = new Date();
        $title = "Formulario Empresa";
        $formu = new FPDF('P','mm','A4');
        $formu->AddPage();
        $formu->SetTextColor(0);    
        $formu->Ln();
        $formu->SetFillColor(236,248,240);
        $formu->Image('public/img/logo-confaguajira.jpg',50,5,110,50);
        $formu->Cell(0,30,"","",1,0,0,0);
        $formu->Image('public/img/Incontec1.jpg',10,40,20,30);
        $formu->Image('public/img/Incontec2.jpg',30,45,20,20);
        $formu->Image('public/img/LogoSuperSubsi.png',202,190,8,60);
        $formu->Cell(0,20,"","",1,0,0,0);
        $formu->SetFont('Arial','','15');
        $formu->setX(10);
        $formu->settextcolor(80,177,116);
        $formu->Cell(115,4,"SOLICITUD DE AFILIACION    ","",0,"R",0,0);
        $formu->settextcolor(0);
        $formu->SetFont('Arial','','9');
        $formu->Cell(25,5,UTF8_DECODE("Año"),"LTR",0,"L",1,0);
        $formu->Cell(25,5,"Mes","LRT",0,"L",1,0);
        $formu->Cell(25,5,"Dia","LRT",1,"L",1,0);
        $formu->Cell(115,2,"","R",0,0,0,0);
        $formu->Cell(25,2,"","R",0,0,0,0);
        $formu->Cell(25,2,"","R",0,0,0,0);
        $formu->Cell(25,2,"","R",1,0,0,0);
        $formu->SetFont('Arial','','15');
        $formu->settextcolor(80,177,116);
        $formu->Cell(115,4,"DEL EMPLEADOR DEL       ",0,0,0,0,0);
        $formu->settextcolor(0);
        $formu->Cell(25,6,$today->getYear(),"LRB",0,"C",0,0);
        $formu->Cell(25,6,$today->getMonth(),"LRB",0,"C",0,0);
        $formu->Cell(25,6,$today->getDay(),"LRB",1,"C",0,0);
        $formu->settextcolor(80,177,116);
        $formu->Cell(115,4,"SERVICIO DOMESTICO       ",0,0,0,0,0);
        $formu->settextcolor(0);
        $formu->Cell(0,10,"","",1,0,0,0);
        $formu->Ln();
        $formu->setX(10);
        $formu->SetFont('Arial','B','9');
        $formu->Cell(190,5,"I. DATOS DEL EMPLEADOR","LRTB",1,"L",1,0);
        $formu->Cell(190,2,"",1,0,1,0);
        $formu->Ln();
        $formu->SetFont('Arial','B','7');
        $formu->Cell(95,5," NOMBRES Y APELLIDOS EMPLEADOR","LT",0,"L",1,0);
        $formu->Cell(50,5,"TIPO DE DOCUMENTO","LT",0,"L",1,0);
        $formu->Cell(45,5,"NO. DE IDENTIDAD","LRT",1,"L",1,0);
        while(($formu->GetStringWidth($razsoc)-85)>0) 
            $razsoc = substr($razsoc,0,strlen($razsoc)-4)."...";
        $formu->Cell(95,5,$razsoc,"L",0,"C",0,0);
        $a="";
        $b="";
        $c="";
        if($coddoc==1)$a="X";
        if($coddoc==4)$b="X";
        if($coddoc==7)$c="X";
        $formu->Cell(10,5,"C.C.","L",0,"L",0,0);
        $formu->Cell(5,3,$a,"LRTB",0,0,0,0);
        $formu->Cell(10,5,"C.E.","",0,"L",0,0);
        $formu->Cell(5,3,$b,"LTRB",0,0,0,0);
        $formu->Cell(10,5,"P.P.","",0,"L",0,0);
        $formu->Cell(5,3,$c,"LTRB",0,0,0,0);
        $formu->Cell(5,5,"","",0,0,0,0);
        $formu->Cell(45,5,$nit,"LR",1,"C",0,0);
        $formu->Cell(95,1,"","LRB",0,0,0,0);
        $formu->Cell(50,1,"","RB",0,0,0,0);
        $formu->Cell(45,1,"","RB",1,0,0,0);
        $formu->Cell(85,5," DIRECCION","LT",0,"L",1,0);
        $formu->Cell(65,5,"CIUDAD","LT",0,"L",1,0);
        $formu->Cell(40,5,"TELEFONO","LRT",1,"L",1,0);
        while(($formu->GetStringWidth($direccion)-75)>0) 
            $direccion = substr($direccion,0,strlen($direccion)-4)."...";
        $formu->Cell(85,6,$direccion,"L",0,"C",0,0);
        $formu->Cell(65,6,$ciudad[0]['detciu'],"L",0,"C",0,0);
        $formu->Cell(40,6,$telefono,"LR",1,"C",0,0);
        //$formu->Cell(55,5," APARTADO AERIO","LT",0,"L",1,0);
        $formu->Cell(100,5,"FAX","LT",0,"L",1,0);
        $formu->Cell(90,5,"EMAIL","LTR",1,"L",1,0);
        //$formu->Cell(55,6,"","L",0,0,0,0);
        $formu->Cell(100,6,$fax,"L",0,"C",0,0);
        $formu->Cell(90,6,$email,"LR",1,"C",0,0);
        $formu->Cell(95,5," CODIGO ACTIVIDAD ECOOMICA ( DIAN )","LT",0,"L",1,0);
        $formu->Cell(95,5," CODIGO ACTIVIDAD ECONOMICA ( DIAN )","LTR",1,"L",1,0);
        $formu->Cell(95,6,$codact,"LR",0,"C",0,0);
        $actividad = $activi[0]['detalle'];
        while(($formu->GetStringWidth($actividad)-75)>0) 
            $actividad = substr($actividad,0,strlen($actividad)-4)."...";
        $formu->Cell(95,6,$actividad,"R",1,"C",0,0);
        $formu->Cell(190,5," NOTA","LTR",1,"L",1,0);
        $formu->Cell(190,3,"  Daran derecho al subsidio familiar las personas a cargo de los trabajadores","LR",1,"L",0,0);
        $formu->Cell(190,1,"","LR",1,0,0,0);
        $formu->Cell(190,3,"  beneficiarios tales como : Hijos, hijastros , padres y hermanos huerfanos de padres","LR",1,"L",0,0);
        $formu->Cell(190,3,"","LRB",1,0,0,0);
        $formu->Ln();
        $formu->Cell(190,3,"DECLARO BAJO LA GRAVEDAD DE JURAMENTO QUE LA INFORMACION SUMINISTRADA ES VERIDICA Y AUTORIZO A COMFAGUAJIRA A QUE VERIFIQUE ","",1,"L",0,0);
        $formu->Cell(190,1,"","",1,0,0,0);
        $formu->Cell(190,3,"LOS DATOS AQUI CONTENIDOS EN CASO DE FALSEDAD A QUE APLIQUEN LAS SANCIONES CONTEMPLADAS EN LA LEY.","",1,"L",0,0); 
        $formu->Ln();
        $formu->Ln();
        $formu->Cell(117,3," Recibido responsable de afiliaciones","",0,"R",0,0);
        $formu->Cell(60,3," Recibido seccion de aportes","",1,"R",0,0);
        $formu->Cell(7,3,"","",0,0,0,0);
        $formu->Cell(45,20,"","LRT",0,0,0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,20,"","LRT",0,0,0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,20,"","LRT",0,0,0,0);
        $formu->Cell(8,20,"","",1,0,0,0);
        $formu->Cell(7,3,"","",0,0,0,0);
        $formu->Cell(45,3,"__________________________","LR",0,"C",0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,3,"__________________________","LR",0,"C",0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,3,"__________________________","LR",0,"C",0,0);
        $formu->Cell(7,3,"","",1,0,0,0);
        $formu->Cell(7,3,"","",0,0,0,0);
        $formu->Cell(45,3,"Firma del empleador","LR",0,"C",0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,3,"Firma y sello Comfaguajira","LR",0,"C",0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,3,"Firma y sello","LR",0,"C",0,0);
        $formu->Cell(7,3,"","",1,0,0,0);
        $formu->Cell(7,3,"","",0,0,0,0);
        $formu->Cell(45,3,"","LRB",0,"C",0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,3,"","LRB",0,"C",0,0);
        $formu->Cell(20,20,"","",0,0,0,0);
        $formu->Cell(45,3,"","LRB",0,"C",0,0);
        $formu->Cell(7,3,"","",1,0,0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','8');
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(0,2,"","LRT",1,"L",0,0);
        $formu->Cell(5,4,"","L",0,"L",0,0);
        $formu->Cell(185,4,"PARA USO EXCLUSIVO DE APORTES Y SUBSIDIOS","R",1,"L",0,0);
        $formu->Cell(190,2,"","LR",1,0,0,0);
        $formu->SetFont('Arial','','7');
        $formu->Cell(10,3,"","L",0,0,0,0);
        $formu->Cell(80,3,"Relacion de trabajadores o nomina","",0,"L",0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(97,3,"","R",1,0,0,0);
        $formu->Cell(190,2,"","LR",1,0,0,0);
        $formu->Cell(10,3,"","L",0,0,0,0);
        $formu->Cell(80,3,"Paz y salvo de afiliacion anterior a una Caja de Compensacon","",0,"L",0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(97,3,"","R",1,0,0,0);
        $formu->Cell(10,3,"","L",0,0,0,0);
        $formu->Cell(180,3,"dentro del Departamento de La Guajira","R",1,"L",0,0);
        $formu->Cell(190,2,"","LR",1,0,0,0);
        $formu->Cell(10,3,"","L",0,0,0,0);
        $formu->Cell(80,3,"Oficio de solicitud de afiliacion","",0,"L",0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(97,3,"","R",1,0,0,0);
        $formu->Cell(190,2,"","LR",1,0,0,0);
        $formu->Cell(10,3,"","L",0,0,0,0);
        $formu->Cell(80,3,"Fotocopia de la cedula","",0,"L",0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->Cell(97,3,"","R",1,0,0,0);
        $formu->Cell(190,2,"","LR",1,0,0,0);
        $formu->Cell(10,3,"","L",0,0,0,0);
        $formu->Cell(80,3,"Carta de aceptacion","",0,"L",0,0);
        $formu->SetDrawColor(0);
        $formu->Cell(3,3,"","LRBT",0,0,0,0);
        $formu->SetDrawColor(10,173,72);
        $formu->settextcolor(80,177,116);
        $formu->Cell(97,3,"SM-FO-022 Version","R",1,"R",0,0);
        $formu->SetTextColor(0);
        $formu->Cell(190,2,"","LRB",1,0,0,0);
        $formu->AddPage();
        $formu->SetMargins(20,10,17);
        $formu->SetFont('Arial','B','15');
        $formu->Cell(0,6,"INFORMACION IMPORTANTE",0,1,"C",0,0);
        $formu->Ln();
        $formu->SetFont('Arial','','11.5');

        $formu->MultiCell(0,5,"1.-            DEBE INCLUIRSE TODO EL PERSONAL.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"2.-            TRABAJADORES CON SUBSIDIO: TIENEN DERECHO A SUBSIDIO LOS TRABAJADORES PERMANENTES, CON PERSONAS A CARGO, CUYA REMUNERACION MENSUAL NO SOBREPASE LOS (4) SALARIOS MINIMOS Y QUE LABOREN POR LO MENOS 96 HORAS AL MES.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,utf8_decode(html_entity_decode("3-              LOS HIJOS CAUSAN DERECHO AL SUBSIDIO CUANDO DEPENDEN ECONOMICAMENTE DEL TRABAJADOR Y CONVIVAN CON EL, ENTRE LOS 12 Y 18 A&Ntilde;OS DEBEN ACREDITAR ESCOLARIDAD.")),"","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"4.-            TRABAJADORES SIN SUBSIDIO: SON LOS QUE NO TIENEN DERECHO A SUBSIDIO MONETARIO POR NO CUMPLIR LOS REQUISITOS DEL NUMERAL 3.","","L",0);
        $formu->Ln();
        $formu->SetFont('Arial','B','15');
        $formu->Cell(0,6,"DOCUMENTOS ANEXOS A LA SOLICITUD",0,1,"C",0,0);
        $formu->Ln();
        $formu->SetFont('Arial','','11.5');
        $formu->MultiCell(0,5,"1.-            COMUNICACION ESCRITA DIRIGIDA A LA RESPECTIVA CAJA DE COMPENSACION FAMILIAR, EN LA QUE INFORME: NOMBRE DEL EMPLEADOR, DOMICILIO, IDENTIFICACION, LUGAR DONDE SE CAUSEN LOS SALARIOS Y MANIFESTACION SOBRE SI ESTABA O NO AFILIADO A ALGUNA CAJA DE COMPENSACION FAMILIAR.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"2.-            FOTOCOPIA DE LA CEDULA DE CIUDADANIA.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"3.-            CERTIFICADO DE PAZ Y SALVO EN EL CASO DE AFILIACION ANTERIOR A OTRA CAJA DENTRO DEL DEPARTAMENTO DE LA GUAJIRA.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"4.-           RELACION DE TRABAJADORES; EL CUAL DEBE INCLUIR SALARIOS Y NUMERO DE DOCUMENTO DE IDENTIFICACION, FIRMADA POR EL EMPLEADOR.","","L",0);
        $formu->Ln();
        $formu->MultiCell(0,5,"  LA SOLICITUD SE RADICARA POR LA RESPECTIVA CAJA. ","","L",0);
        $this->setResponse('view');
        $file = "public/temp/reportes/empresa_$nit.pdf";
        $formu->Output( $file,"F");
        return $file;
    }

    public function reporte_empresa_f(){
    
        $nit = $this->getPostParam("nit","addslaches","numeric","extraspaces","striptags");
        $calemp = $this->getPostParam("calemp","addslaches","alpha","extraspaces","striptags");
        $razsoc = $this->getPostParam("razsoc","addslaches","alpha","extraspaces","striptags");
        $digver = $this->getPostParam("digver","addslaches","alpha","extraspaces","striptags");
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $codciu = $this->getPostParam("codciu","addslaches","alpha","extraspaces","striptags");
        $ciudad = parent::webService('nombreCiudad',array("codciu"=>$codciu));
        $codact = $this->getPostParam("codact","addslaches","alpha","extraspaces","striptags");
        $activi = parent::webService('actividad',array("codact"=>$codact));
        $autoriza= $this->getPostParam("autoriza","addslaches","alpha","extraspaces","striptags");
        $direccion = $this->getPostParam("direccion","addslaches","extraspaces","striptags");
        $telefono = $this->getPostParam("telefono","addslaches","alpha","extraspaces","striptags");
        $fax = $this->getPostParam("fax","addslaches","alpha","extraspaces","striptags");
        $email = $this->getPostParam("email","addslaches","extraspaces","striptags");
        $pagweb = $this->getPostParam("pagweb","addslaches","extraspaces","striptags");
        $feccon = $this->getPostParam("feccon","addslaches","extraspaces","striptags");
        $tottra = $this->getPostParam("tottra","addslaches","alpha","extraspaces","striptags");
        $totnom = $this->getPostParam("totnom","addslaches","alpha","extraspaces","striptags");
        $cedrep = $this->getPostParam("cedrep","addslaches","alpha","extraspaces","striptags");
        $pymes = $this->getPostParam("pymes","addslaches","alpha","extraspaces","striptags");
        $nomrep = $this->getPostParam("nomrep","addslaches","alpha","extraspaces","striptags");
        $tipemp = $this->getPostParam("tipemp","addslaches","alpha","extraspaces","striptags");
        $tipsoc = $this->getPostParam("tipsoc","addslaches","alpha","extraspaces","striptags");
        $tipsoci = parent::webService('sociedad',array("tipsoc"=>$tipsoc));
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $direccions = $this->getPostParam("direccions","addslaches","alpha","extraspaces","striptags");
        $codcius = $this->getPostParam("codcius","addslaches","alpha","extraspaces","striptags");
        $ciudads = parent::webService('nombreCiudad',array("codciu"=>$codcius));
        $telefonos = $this->getPostParam("telefonos","addslaches","alpha","extraspaces","striptags");
        $faxs = $this->getPostParam("faxs","addslaches","alpha","extraspaces","striptags");
        $emails = $this->getPostParam("emailsub","addslaches","extraspaces","striptags");
        $soceco= $this->getPostParam("soceco","addslaches","alpha","extraspaces","striptags");
        $today = new Date();
        $title = "Formulario Empresa";
        $formu = new FPDF('P','mm','A4');
        $formu->AddPage();
        $formu->SetTextColor(0);    
        $formu->Ln();
        $formu->SetFillColor(236,248,240);
        $formu->Image('public/img/logo-confaguajira.jpg',8,5,70,33);
        $formu->Image('public/img/Incontec1.jpg',158,12,20,20);
        $formu->Image('public/img/Incontec2.jpg',179,12,20,20);
        $formu->Image('public/img/LogoSuperSubsi.png',202,190,8,60);
        $formu->SetFont('Arial','B','12');
        $formu->settextcolor(80,177,116);
        $formu->Cell(190,5,"","LRT",1,0,0);
        $formu->Cell(70,4,"","L",0,0,0);
        $formu->Cell(70,4,"","","C",0,0);
        $formu->Cell(50,4,"","R",1,0,0);
        $formu->Cell(70,4,"","L",0,0,0);
        $formu->Cell(70,4,"","","C",0,0);
        $formu->Cell(50,4,"","R",1,0,0);
        $formu->Cell(70,4,"","L",0,0,0);
        $formu->Cell(70,5,"SOLICITUD DE AFILIACION","","C",0,0);
        $formu->Cell(50,4,"","R",1,0,0);
        $formu->Cell(70,4,"","L",0,0,0);
        $formu->Cell(70,5,"DE FACULTATIVOS Y PENSIONADOS","","C",0,0);
        $formu->Cell(50,4,"","R",1,0,0);
        $formu->Cell(190,2,"","LRB",1,0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','8');
        $formu->settextcolor(0);
        $formu->Cell(190,1,"","LTR",1,"L",1,0);
        $formu->Cell(60,5,"TIPO DE AFILIACION","L",0,"L",1,0);
        $formu->Cell(20,5,"","",0,"L",1,0);
        $a="";
        $b="";
        if($calemp=="P")$a="X";
        if($calemp=="F")$b="X";
        $formu->Cell(30,5,"PENSIONADO","",0,"L",1,0);
        $formu->Cell(4,4,$a,"LRBT",0,"L",0,0);
        $formu->Cell(20,5,"","",0,"",1,0);
        $formu->Cell(30,5,"FACULTATIVO","",0,"L",1,0);
        $formu->Cell(4,4,$b,"LRTB",0,"L",0,0);
        $formu->Cell(22,5,"","R",1,"L",1,0);
        $formu->Cell(190,2,"","LRB",1,0,0,0);
        $formu->Cell(190,2,"","LTR",1,"L",1,0);
        $formu->Cell(60,5,"SOLICITANTE","L",0,"L",1,0);
        $formu->Cell(20,5,"","",0,"L",1,0);
        $formu->Cell(30,5,"PERSONA NATURAL ","",0,"L",1,0);
        $formu->Cell(4,4,"","LRTB",0,"L",0,0);
        $formu->Cell(20,5,"","",0,"",1,0);
        $formu->Cell(30,5,"PERSONA JURIDICA","",0,"L",1,0);
        $formu->Cell(4,4,"","LRTB",0,"L",0,0);
        $formu->Cell(22,5,"","R",1,"L",1,0);
        $formu->Cell(190,2,"","LRB",1,0,0,0);
        $formu->Cell(120,2,"","LTR",0,"L",1,0);
        $formu->Cell(70,2,"","LTR",1,"L",1,0);
        $formu->Cell(120,4,"NOMBRE O RAZON SOCIAL","L",0,"L",1,0);
        $formu->Cell(70,4,"NIT","RL",1,"L",1,0);
        while(($formu->GetStringWidth($razsoc)-110)>0) 
        $razsoc = substr($razsoc,0,strlen($razsoc)-4)."...";
        $formu->Cell(120,4,$razsoc,"L",0,"L",0,0);
        $formu->Cell(70,4,$nit,"RL",1,"C",0,0);
        $formu->Cell(190,1,"","LRB",1,0,0,0);
        $formu->Cell(90,4," DIRECCION   ","LT",0,"L",1,0);
        $formu->Cell(50,4,"CIUDAD ","LT",0,"L",1,0);
        $formu->Cell(50,4,"TELEFONO ","LTR",1,"L",1,0);
        while(($formu->GetStringWidth($direccion)-85)>0) 
        $direccion = substr($direccion,0,strlen($direccion)-4)."...";
        $formu->Cell(90,4,$direccion,"L",0,"C",0,0);
        $formu->Cell(50,4,$ciudad[0]['detciu'],"L",0,"C",0,0);
        $formu->Cell(50,4,$telefono,"LR",1,"C",0,0);
        $formu->Cell(60,5," FECHA DE CONSTITUCION ","LT",0,"L",1,0);
        $formu->Cell(20,5,"","LTR",0,"L",1,0);
        $formu->Cell(20,5,"","LTR",0,"L",1,0);
        $formu->Cell(90,5,"VALOR INGRESO PROMEDIO ","LTR",1,"L",1,0);
        $formu->Cell(60,5,substr($feccon , 8),"L",0,"R",0,0);
        $formu->Cell(20,5,substr($feccon , 5,2),"LR",0,"C",0,0);
        $formu->Cell(20,5,substr($feccon , 0,4),"LR",0,"C",0,0);
        $formu->Cell(90,5,$totnom,"LR",1,"C",0,0);
        $formu->Cell(190,5,"CODIGO ACTIVIDAD ECONOMICA ( DIAN )  ","LTR",1,"L",1,0);
        $formu->Cell(50,5,$codact,"LB",0,"C",0,0);
        $actividad = $activi[0]['detalle'];
        while(($formu->GetStringWidth($actividad)-135)>0) 
        $actividad = substr($actividad,0,strlen($actividad)-4)."...";
        //$formu->Cell(140,5,$activi[0]['detalle'],"LRB",1,"C",0,0);
        $formu->Cell(140,5,$actividad,"LRB",1,"C",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->Cell(190,5,UTF8_DECODE("DATOS DEL CONYUGE O COMPAÑERA "),0,1,"L",0,0);
        $formu->Cell(90,2,"","LTR",0,"L",1,0);
        $formu->Cell(100,2,"","LTR",1,"L",1,0);
        $formu->Cell(40,5,"TIPO DE DOCUMENTO ","L",0,"L",1,0);
       /* $a="";
        $b="";
        $c="";
        if($coddoc==1)$a="X";
        if($coddoc==4)$b="X";
        if($coddoc==2)$c="X";*/
        $formu->Cell(10,5,"C.C.",0,0,"L",1,0);
        $formu->Cell(5,5,"",1,0,"L",0,0);
        $formu->Cell(10,5,"C.E.",0,  0,"L",1,0);
        $formu->Cell(5,5,"",1,0,"L",0,0);
        $formu->Cell(10,5,"T.I.",0,0,"L",1,0);
        $formu->Cell(5,5,"",1,0,"L",0,0);
        $formu->Cell(5,5,"",0,0,"L",1,0);
        $formu->Cell(100,5,UTF8_DECODE("No. DE IDENTIFICACION "),"LR",1,"L",1,0);
        $formu->Cell(90,5,"","LBR",0,"L",0,0);
        $formu->Cell(100,5,"","LBR",1,"L",0,0);
        $formu->Cell(50,5,"PRIMER APELLIDO","L",0,"L",1,0);
        $formu->Cell(50,5,"SEGUNDO APELLIDO",0,0,"L",1,0);
        $formu->Cell(90,5,"NOMBRES","R",1,"L",1,0);
        $formu->Cell(50,5,"","LB",0,"L",0,0);
        $formu->Cell(50,5,"","B",0,"L",0,0);
        $formu->Cell(90,5,"","BR",1,"L",0,0);
        $formu->Cell(160,8,UTF8_DECODE("PERSONAS A CARGO"),0,1,"L",0,0);
        $formu->SetFont('Arial','B','7');
        $formu->Cell(40,5,"APELLIDOS Y NOMBRES","LTR",0,"L",1,0);
        $formu->Cell(40,5,"DOCUMENTO DE IDENTIDAD","LTRB",0,"L",1,0);
        $formu->Cell(14,5,"SEXO","LTRB",0,"C",1,0);
        $formu->Cell(40,5,"FECHA DE NACIMIENTO","LTRB",0,"L",1,0);
        $formu->Cell(30,5,"PARENTESCO","LTR",0,"L",1,0);
        $formu->Cell(25,5,"ESTUDIOS","LTR",1,"C",1,0);
        $formu->Cell(40,5,"","LRB",0,"C",0,0);
        $formu->Cell(10,5,"TIPO","LRB",0,"C",0,0);
        $formu->Cell(30,5,"NUMERO","LRB",0,"C",0,0);
        $formu->Cell(7,5,"M","LRB",0,"C",0,0);
        $formu->Cell(7,5,"F","LRB",0,"C",0,0);
        $formu->Cell(14,5,UTF8_DECODE("AÑO"),"LRB",0,"C",0,0);
        $formu->Cell(13,5,"MES","LRB",0,"C",0,0);
        $formu->Cell(13,5,UTF8_DECODE("DÍA"),"LRB",0,"C",0,0);
        $formu->Cell(30,5,"","LRB",0,"C",0,0);
        $formu->Cell(25,5,"","LRB",1,"C",0,0);
        $formu->Cell(40,5,"","LTRB",0,"C",0,0);
        $formu->Cell(10,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(14,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(25,5,"","LTRB",1,"C",0,0);
        $formu->Cell(40,5,"","LTRB",0,"C",0,0);
        $formu->Cell(10,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(14,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(25,5,"","LTRB",1,"C",0,0);
        $formu->Cell(40,5,"","LTRB",0,"C",0,0);
        $formu->Cell(10,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(14,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(25,5,"","LTRB",1,"C",0,0);
        $formu->Cell(40,5,"","LTRB",0,"C",0,0);
        $formu->Cell(10,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(14,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(25,5,"","LTRB",1,"C",0,0);
        $formu->Cell(40,5,"","LTRB",0,"C",0,0);
        $formu->Cell(10,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(7,5,"","LTRB",0,"C",0,0);
        $formu->Cell(14,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(13,5,"","LTRB",0,"C",0,0);
        $formu->Cell(30,5,"","LTRB",0,"C",0,0);
        $formu->Cell(25,5,"","LTRB",1,"C",0,0);
        $formu->Cell(10,2,"",0,1,"C",0,0);
        $formu->Ln();
        $formu->SetFont('Arial','','9');
        $formu->Cell(190,2,"Bajo gravedad de juramento declaro que los datos consignados en este formato reflejan la realidad del solicitante  ",0,1,"L",0,0);
        $formu->Cell(190,2,"","B",1,"C",0,0);
        $formu->Cell(190,2,"",0,1,0,0,0);
        $formu->SetFont('Arial','','7.8');
        $formu->Cell(180,2,"Declaro bajo gravedad de juramento que la informacion suministrada es verificada y autorizo a Comfaguajira a que verifique los datos aqui contenidos y",0,1,"L",0,0);
        $formu->Cell(180,3,"en caso de falsedad se apliquen las sanciones contempladas e la ley.",0,1,"L",0,0);
        $formu->Cell(190,2,"","B",1,"C",0,0);
        $formu->SetFont('Arial','','7.3');
        $formu->Cell(180,4,"Autorizo a Comfaguajira a utilizar los datos aquiregistrados para que sean tratados de manera confidencial, segura, leal y transparente en los terminos y condiciones",0,1,"L",0,0);
        $formu->Cell(180,3,UTF8_DECODE("señalados en la ley 1581 de 2012 y decreto 1377 de 2013, para el desarrollo de campañas promocionales, ofertas de servicios y programas de fidelizacion "),0,1,"L",0,0);
        $formu->Cell(2,3," ",0,"L",0,0);
        $formu->Cell(100,3,UTF8_DECODE("   diseñada, implementadas y administradas por COMFAGUAJIRA o terceros autorizados"),0,"L",0,0);
        $a="";
        $b="";
        if($autoriza=="S")$a="X";
        if($autoriza=="N")$b="X";
        $formu->Cell(5,3,", SI",0,0,"L",0,0);
        $formu->Cell(3,3,$a,"B",0,"L",0,0);
        $formu->Cell(5,3,"NO",0,0,"L",0,0);
        $formu->Cell(3,3,$b,"B",0,"L",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Cell(5,2,"","",0,0,0,0);
        $formu->Cell(50,2,"","LRT",0,0,0,0);
        $formu->Cell(10,2,"","",0,0,0,0);
        $formu->Cell(50,2,"","LRT",0,0,0,0);
        $formu->Cell(10,2,"","",0,0,0,0);
        $formu->Cell(50,2,"","LRT",0,0,0,0);
        $formu->Cell(8,2,"",0,1,0,0,0);
        $formu->Cell(5,3,"",0,0,0,0,0);
        $formu->Cell(50,3,"Independiente o pensionado","LR",0,"C",0,0);
        $formu->Cell(10,3,"",0,0,0,0,0);
        $formu->Cell(50,3,"Recibo Responsabilidad de Afiliacion","LR",0,"C",0,0);
        $formu->Cell(10,3,"",0,0,0,0,0);
        $formu->Cell(50,3,"Departamento de aportes y subsidio","LR",0,"C",0,0);
        $formu->Cell(8,3,"",0,1,0,0,0);
        $formu->Cell(5,15,"","",0,0,0,0);
        $formu->Cell(50,15,"","LR",0,0,0,0);
        $formu->Cell(10,15,"","",0,0,0,0);
        $formu->Cell(50,15,"","LR",0,0,0,0);
        $formu->Cell(10,15,"","",0,0,0,0);
        $formu->Cell(50,15,"","LR",0,0,0,0);
        $formu->Cell(8,15,"",0,1,0,0,0);
        $formu->Cell(5,3,"",0,0,0,0,0);
        $formu->Cell(50,3,"","LR",0,"C",0,0);
        $formu->Cell(10,30,"","",0,0,0,0);
        $formu->Cell(50,3,"","LR",0,"C",0,0);
        $formu->Cell(10,30,"","",0,0,0,0);
        $formu->Cell(50,3,"","LR",0,"C",0,0);
        $formu->Cell(8,3,"","",1,0,0,0);
        $formu->Cell(5,3,"","",0,0,0,0);
        $formu->Cell(50,3,"Firma","LR",0,"C",0,0);
        $formu->Cell(10,20,"","",0,0,0,0);
        $formu->Cell(50,3,"Firma, Sello de Comfaguajira y fecha","LR",0,"C",0,0);
        $formu->Cell(10,20,"","",0,0,0,0);
        $formu->Cell(50,3,"Firma, Sello de Comfaguajira y fecha","LR",0,"C",0,0);
        $formu->Cell(8,3,"","",1,0,0,0);
        $formu->Cell(5,3,"","",0,0,0,0);
        $formu->Cell(50,3,"","LRB",0,"C",0,0);
        $formu->Cell(10,20,"","",0,0,0,0);
        $formu->Cell(50,3,"","LRB",0,"C",0,0);
        $formu->Cell(10,20,"","",0,0,0,0);
        $formu->Cell(50,3,"","LRB",0,"C",0,0);
        $formu->Cell(8,3,"","",1,0,0,0);
        $formu->Ln();
        $formu->SetFont('Arial','B','10');
        $formu->Cell(90,4,"PARA USO EXCLUSIVO DE APORTES Y SUBSIDIO.","",0,"L",0,0);
        $formu->Cell(90,4,"Cod.SM-FO-9 Version:3    ","",1,"R",0,0);
        $formu->SetFont('Arial','','9');
        $formu->Ln();
        $formu->Cell(190,4,"* Oficio de solicitud de Afiliacion","",1,"L",0,0);
        $formu->Cell(190,4,"* Prueba de existencia y representeacion legal. (Encaso de ser persona juridica)","",1,"L",0,0);
        $formu->Cell(190,4,"* Fotocopia de a Cedula. (Encaso de ser persona natural) ","",1,"L",0,0);
        $formu->Cell(190,4,"* Certificado de paz y salvo en caso de afiliacion anterior a otra caja.","",1,"L",0,0);
        $formu->Cell(190,4,"* Carta de Aceptacion.","",1,"L",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','12');
        $formu->Cell(190,4,utf8_decode("¿QUIENES PUEDEN AFILIARSE?"),"",1,"L",0,0);
        $formu->SetFont('Arial','','10');
        $formu->Cell(190,4,"","",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("Las personas naturales o juridica tales como:"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Los profecionales independientes, con titulo reconocido por establecimientos de educacion superior que ejerza su"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("profecion sin que medie vinculo laboral."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Congregacones religiosas, las agreminaciones, organizaciones politicas o instituciones legalmente reconocidas. "),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Trabajadores independientes o personas vinculadas por contratacion de servicios."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Personas o grupo de personas que segun el criterio de evaluacion de la Caja considere su proceso de afiliación."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode(""),"",1,"L",0,0);
        $formu->Ln();
        $formu->SetFont('Arial','B','12');
        $formu->Cell(190,4,utf8_decode("PROCEDIMIENTO PARA LA AFILIACIÒN"),"",1,"L",0,0);
        $formu->SetFont('Arial','','10');
        $formu->Cell(190,4,"","",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Mediante la celebracion de un convenio, previa solicitud por escrito de la poesona o grupos de personas que deseen"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  vincularse."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Mediante un formulario de afiliacion, debidamente diligenciado, respaldado por todos los documentos exigidos."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','12');
        $formu->Cell(190,4,utf8_decode("BENEFICIARIOS FACULTATIVOS"),"",1,"L",0,0);
        $formu->SetFont('Arial','','10');
        $formu->Cell(190,4,"","",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? El conyuge o compañera permanente."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Hijos menores de 18 años."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Padres mayores de 60 años."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Cell(190,4,utf8_decode("  En todos los casos se debera acreditar los siguientes documentos."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Cell(190,4,utf8_decode("  HIJO:"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  Registro civil donde aparesca el nombre de los padres para poder establecer el parentesco."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Cell(190,4,utf8_decode("  HIJOS ADOPTIVOS:"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  Registro civil o copia de sentencia del juez de Menores que decreto la adopcion."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Cell(190,4,utf8_decode("  HIJASTROS:"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  Registro civil, declaracion extra-juicio donde conste convivienda y dependencia economica con el trabajador por mas de"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  dos(2) años, visita del trabajador social."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Cell(190,4,utf8_decode("  PADRES MAYORES DE SESENTA AÑOS:"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  Deben ser afiliados por un solo hijo, si mas de ellos desean afiliarse, forocopia de la cedula autenticada en una notaria"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  registro civil o partida de bautismo del padre y registro civil del trabajador, prueba de superviviencia de los padres."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  NOTA: los beneficiarios no tienen derecho a subsidio monetario y Subsidio en especie."),"",1,"L",0,0);
        $formu->Ln();
        $formu->Ln();
        $formu->SetFont('Arial','B','12');
        $formu->Cell(190,4,utf8_decode("DOCUMENTOS ANEXOS A LA SOLICITUD"),"",1,"L",0,0);
        $formu->SetFont('Arial','','10');
        $formu->Cell(190,4,"","",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Comunicacion escrita dirigida a la respectiva Caja de Compensacion Familiar en la que informe: Nombre del afiliado,"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  domicilio, identificacion, lugar donde se causen lo salarios y manifestaciones sobre si estaba o no afiliado a alguna Caja de"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  Compensacion Familiar."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Prueba de existencia y reprecentacion legal tratandose de persona juridica. Encaso de las personas naturales bastara la"),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("  presentacion de fotocopia de la cedula de ciudadania."),"",1,"L",0,0);
        $formu->Cell(190,4,utf8_decode("? Certificado de paz y salvoen caso de afiliacion anterios a otra Caja."),"",1,"L",0,0);
        $this->setResponse('view');
        $file = "public/temp/reportes/empresa_$nit.pdf";
        $formu->Output( $file,"F");
        return $file;


    }
    
    public function addempresaAction(){
      try{
        try{
          $modelos = array("mercurio30","mercurio21","mercurio37");
          $Transaccion = parent::startTrans($modelos);
          $nit = $this->getPostParam("nit","addslaches","alpha","extraspaces","striptags");
          $razsoc = $this->getPostParam("razsoc","addslaches","alpha","extraspaces","striptags");
          $digver = $this->getPostParam("digver","addslaches","alpha","extraspaces","striptags");
          $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
          $codciu = $this->getPostParam("codciu","addslaches","alpha","extraspaces","striptags");
          $direccion = $this->getPostParam("direccion","addslaches","alpha","extraspaces","striptags");
          $telefono = $this->getPostParam("telefono","addslaches","alpha","extraspaces","striptags");
          $fax = $this->getPostParam("fax","addslaches","alpha","extraspaces","striptags");
          $email = $this->getPostParam("email","addslaches","extraspaces","striptags");
          $pagweb = $this->getPostParam("pagweb","addslaches","extraspaces","striptags");
          $feccon = $this->getPostParam("feccon","addslaches","alpha","extraspaces","striptags");
          $codact = $this->getPostParam("codact","addslaches","alpha","extraspaces","striptags");
          $tottra = $this->getPostParam("tottra","addslaches","alpha","extraspaces","striptags");
          $totnom = $this->getPostParam("totnom","addslaches","alpha","extraspaces","striptags");
          $cedrep = $this->getPostParam("cedrep","addslaches","alpha","extraspaces","striptags");
          $nomrep = $this->getPostParam("nomrep","addslaches","alpha","extraspaces","striptags");

          $codare = $this->getPostParam("codare","addslaches","alpha","extraspaces","striptags");
          $codope = $this->getPostParam("codope","addslaches","alpha","extraspaces","striptags");
          $tipemp = $this->getPostParam("tipemp","addslaches","alpha","extraspaces","striptags");
          $tipsoc = $this->getPostParam("tipsoc","addslaches","alpha","extraspaces","striptags");
          $calemp = $this->getPostParam("calemp","addslaches","alpha","extraspaces","striptags");
          $codzon = $this->getPostParam("codzon","addslaches","alpha","extraspaces","striptags");
          $autoriza = $this->getPostParam("autoriza","addslaches","alpha","extraspaces","striptags");
          $zonsuc = $this->getPostParam("codcius","addslaches","alpha","extraspaces","striptags");
          $dirsuc = $this->getPostParam("direccions","addslaches","alpha","extraspaces","striptags");
          $emailsuc = $this->getPostParam("emails","addslaches","alpha","extraspaces","striptags");
          $telsuc = $this->getPostParam("telefonos","addslaches","alpha","extraspaces","striptags");
          $faxsuc = $this->getPostParam("faxs","addslaches","alpha","extraspaces","striptags");
          $nomsub = $this->getPostParam("nomsub","addslaches","alpha","extraspaces","striptags");
          Session::setData('nota_audit',"Ingreso de Empresa");
          $log_id = parent::registroOpcion();
          if($log_id==false)parent::ErrorTrans();
          $mercurio30 = new Mercurio30();
          $mercurio30->setTransaction($Transaccion);
          $mercurio30->setId(0);
          $mercurio30->setLog($log_id);
          $mercurio30->setCodcaj(Session::getDATA('codcaj'));
          $mercurio30->setNit($nit);
          $mercurio30->setRazsoc($razsoc);
          $mercurio30->setDigver($digver);
          $mercurio30->setCoddoc($coddoc);
          $mercurio30->setCodciu($codciu);
          $mercurio30->setDireccion($direccion);
          $mercurio30->setTelefono($telefono);
          $mercurio30->setFax($fax);
          $mercurio30->setEmail($email);
          $mercurio30->setPagweb($pagweb);
          $mercurio30->setFeccon($feccon);
          $mercurio30->setCodact($codact);
          $mercurio30->setTottra($tottra);
          $mercurio30->setTotnom($totnom);
          $mercurio30->setCedrep($cedrep);
          $mercurio30->setNomrep($nomrep);
          $mercurio30->setTipemp($tipemp);
          $mercurio30->setTipsoc($tipsoc);
          $mercurio30->setCalemp($calemp);
          $mercurio30->setCodzon($codzon);
          $mercurio30->setAutoriza($autoriza);
          $mercurio30->setEstado("P");
          $mercurio30->setZonsuc($zonsuc);
          $mercurio30->setDirsuc($dirsuc);
          $mercurio30->setEmailsuc($emailsuc);
          $mercurio30->setTelsuc($telsuc);
          $mercurio30->setFaxsuc($faxsuc);
          $mercurio30->setFaxsuc($nomsub);
          if(!$mercurio30->save()){
            parent::setLogger($mercurio30->getMessages());
            parent::ErrorTrans();
          }
          $mercurio02 = $this->Mercurio02->findFirst("codcaj = '".SESSION::getDATA('codcaj')."'");
          $asunto = "Nuevo Empresa por Aprobar $razsoc";
          $msg = "Cordial Saludos<br><br>Esta pendiente por aprobar la empresa $nit - $razsoc con $tottra trabajadores con una nomina de ".number_format($totnom,0,".",".")."<br><br>Atentamente,<br><br>MERCURIO";
          $ruta_file = "";
          $mercurio13 = $this->Mercurio13->find("codcaj = '".SESSION::getDATA('codcaj')."' AND codare = '$codare' AND codope='$codope'");
          foreach($mercurio13 as $mmercurio13){
              if(isset($_FILES['archivo_'.$mmercurio13->getCoddoc()])){
                  $_FILES["archivo_{$mmercurio13->getCoddoc()}"]['name'] = $mercurio30->getId()."_".$mmercurio13->getCoddoc()."_".$nit.substr($_FILES["archivo_{$mmercurio13->getCoddoc()}"]['name'],-4);
                  $path = "public/files/";
                  $this->uploadFile("archivo_{$mmercurio13->getCoddoc()}",getcwd()."/$path/");
                  $dd=pathinfo($_FILES["archivo_{$mmercurio13->getCoddoc()}"]["name"]);
                  $archivo_nombre = $path.$dd['basename'];
                  $ruta_file[] = $archivo_nombre;
                  $mercurio37 = new Mercurio37();
                  $mercurio37->setTransaction($Transaccion);
                  $mercurio37->setNumero($mercurio30->getId());
                  $mercurio37->setCoddoc($mmercurio13->getCoddoc());
                  $mercurio37->setNomarc($archivo_nombre);
                  if(!$mercurio37->save()){
                      parent::setLogger($mercurio37->getMessages());
                      parent::ErrorTrans();
                  }
              }
          }
          parent::finishTrans();
          $flag_email = parent::enviarCorreo("Afiliacion Empresa desde Mercurio",$razsoc, "mercurio@syseu.com", $asunto, $msg, $ruta_file);
          if($flag_email==false){
              return $this->redirect("principal/index/Se envio el Formulario pero sin correo Electrónico");
          }
          $asuntoemp = "Solicitud de Afiliacion Caja";
          $msgemp ="";
          $msgemp .= "<p>Apreciados ".$razsoc."</p><br/><br/>";
          $msgemp .= "<p>La solicitud de afiliacion a la {$mercurio02->getRazsoc()} se encuentra en estado pendiente por aprobacion. En breve estaremos informandole acerca del estado de su solicitud.</p><br/><br/><br/><br/>";
          $msgemp .= "<p>Atentamente,</p><br/><br/><br/><br/>";
          $msgemp .= "<p>{$mercurio02->getRazsoc()}</p><br/><br/>";
          $flag_email = parent::enviarCorreo("Solicitud de Afiliación a Caja",$razsoc,$email,$asuntoemp,$msgemp,"");
          if($flag_email==false){
              return $this->redirect("principal/index/Se envio el Formulario pero Sin Correo Electrónico");
          }
          //Fin nuevo formato
          return $this->redirect("principal/index/Se Registro Exitosamente");
        } catch (DbException $e) {
            parent::setLogger($e->getMessage());
            parent::ErrorTrans();
        }
      } catch (TransactionFailed $e) {
          return $this->redirect("principal/index/No se pudo registrar");
      }
    }

    public function addtrabajador_viewAction(){
        $this->setResponse("ajax");
        $codare = $this->getPostParam("codare");
        $codope = $this->getPostParam("codope");
        echo parent::showTitle('Afiliarse como Trabajador');
        Tag::displayTo("cedtra", SESSION::getDATA('documento'));
        echo parent::showHelp('Ingrese sus datos personales en cada uno de las campos visualizados en la parte de arriba de forma honesta para poder enviar su afiliacion a la caja de compensacion.');
        $coddoc = parent::webService('tiposdocumentos',array());
        foreach($coddoc as $mcoddoc){
            $_coddoc[$mcoddoc['coddoc']] = $mcoddoc['detalle'];
        }
        $codciu = parent::webService('ciudades',array());
        foreach($codciu as $mcodciu){
            $_codciu[$mcodciu['codciu']] = $mcodciu['detalle'];
        }
        $estciv = parent::webService('estadosciviles',array());
        foreach($estciv as $mestciv){
            $_estciv[$mestciv['estciv']] = $mestciv['detalle'];
        }
        $sexo = parent::webService('sexos',array());
        foreach($sexo as $msexo){
            $_sexo[$msexo['sexo']] = $msexo['detalle'];
        }
        $tipdis = parent::webService('tipdis',array());
        foreach($tipdis as $mtipdis){
            $_tipdis[$mtipdis['tipdis']] = $mtipdis['detalle'];
        }
        $captra = parent::webService('captra',array());
        foreach($captra as $mcaptra){
            $_captra[$mcaptra['captra']] = $mcaptra['detalle'];
        }
        $nivedu = parent::webService('nivedu',array());
        foreach($nivedu as $mnivedu){
            $_nivedu[$mnivedu['nivedu']] = $mnivedu['detalle'];
        }
        $depart = parent::webService('departamento',array());
        foreach($depart as $mdepart ){
            $_depart[$mdepart['coddep']] = $mdepart['detalle'];
        }
        $this->setParamToView("coddoc", $_coddoc);
        $this->setParamToView("codciu", $_codciu);
        $this->setParamToView("coddep", $_depart);
        $this->setParamToView("estciv", $_estciv);
        $this->setParamToView("sexo", $_sexo);
        $this->setParamToView("captra", $_captra);
        $this->setParamToView("tipdis", $_tipdis);
        $this->setParamToView("nivedu", $_nivedu);
        $this->setParamToView("autoriza", array('S'=>'SI','N'=>'NO'));
        $this->setParamToView("cabhog", array('S'=>'SI','N'=>'NO'));
        $this->setParamToView("codare", $codare);
        $this->setParamToView("codope", $codope);
    }

    public function addtrabajador_reportAction(){
        $this->setResponse("ajax");
        $nit = $this->getPostParam("nit","addslaches","alpha","extraspaces","striptags");
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $razsoc = $this->getPostParam("razsoc","addslaches","alpha","extraspaces","striptags");
        $cedtra = $this->getPostParam("cedtra","addslaches","alpha","extraspaces","striptags");
        $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
        $priape = $this->getPostParam("priape","addslaches","alpha","extraspaces","striptags");
        $segape = $this->getPostParam("segape","addslaches","alpha","extraspaces","striptags");
        $prinom = $this->getPostParam("prinom","addslaches","alpha","extraspaces","striptags");
        $segnom = $this->getPostParam("segnom","addslaches","alpha","extraspaces","striptags");
        $fecnac = $this->getPostParam("fecnac","addslaches","extraspaces","striptags");
        $sexo = $this->getPostParam("sexo","addslaches","alpha","extraspaces","striptags");
        $vivienda = $this->getPostParam("vivienda","addslaches","alpha","extraspaces","striptags");
        $estciv = $this->getPostParam("estciv","addslaches","alpha","extraspaces","striptags");
        $codciu = $this->getPostParam("codciu","addslaches","alpha","extraspaces","striptags");
        $coddep = substr($codciu,0,2);
        $ciudad = parent::webService('nombreCiudad',array("codciu"=>$codciu));
        $depart = parent::webService('nombreDep',array("coddep"=>$coddep));
        $direccion = $this->getPostParam("direccion","addslaches","alpha","extraspaces","striptags");
        $telefono = $this->getPostParam("telefono","addslaches","alpha","extraspaces","striptags");
        $celular = $this->getPostParam("celular","addslaches","alpha","extraspaces","striptags");
        $fax = $this->getPostParam("fax","addslaches","alpha","extraspaces","striptags");
        $email = $this->getPostParam("email","addslaches","extraspaces","striptags");
        $fecing = $this->getPostParam("fecing","addslaches","extraspaces","striptags");
        $salario = $this->getPostParam("salario","addslaches","alpha","extraspaces","striptags");
        $tipcon = $this->getPostParam("tipcon","addslaches","alpha","extraspaces","striptags");
        $horas = $this->getPostParam("horas","addslaches","alpha","extraspaces","striptags");
        $nivedu = $this->getPostParam("nivedu","addslaches","alpha","extraspaces","striptags");
        $rural = $this->getPostParam("rural","addslaches","alpha","extraspaces","striptags");
        $captra = $this->getPostParam("captra","addslaches","alpha","extraspaces","striptags");
        $fecnac = new Date($fecnac);
        $fecing = new Date($fecing);
        $today = new Date();
        $cedcon = $this->getPostParam("cedcon","addslaches","alpha","extraspaces","striptags");
        $coddoccon = $this->getPostParam("coddoccon","addslaches","alpha","extraspaces","striptags");
        $priapecon = $this->getPostParam("priapecon","addslaches","alpha","extraspaces","striptags");
        $segapecon = $this->getPostParam("segapecon","addslaches","alpha","extraspaces","striptags");
        $prinomcon = $this->getPostParam("prinomcon","addslaches","alpha","extraspaces","striptags");
        $segnomcon = $this->getPostParam("segnomcon","addslaches","alpha","extraspaces","striptags");
        $fecnaccon = $this->getPostParam("fecnaccon","addslaches","extraspaces","striptags");
        $direccioncon = $this->getPostParam("direccioncon","addslaches","alpha","extraspaces","striptags");
        $telefonocon = $this->getPostParam("telefonocon","addslaches","alpha","extraspaces","striptags");
        $emailcon = $this->getPostParam("emailcon","addslaches","alpha","extraspaces","striptags");
        $autoriza = $this->getPostParam("autoriza","addslaches","alpha","extraspaces","striptags");
        $tipcue = $this->getPostParam("tipcue","addslaches","extraspaces","striptags");
        $fecnaccon = new Date($fecnaccon);
        $title = "Formulario Trabajador";
        $pdf = new FPDF('P','mm','legal');
        $pdf->AddPage();
        $pdf->SetFillColor(236,248,240); 
        $pdf -> Ln();
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','12');
        $pdf->SetTextColor(58,255,78);
        $pdf->Cell(70,2,"","LT",0,0,0,0);
        $pdf->Cell(50,2,"","T",0,0,0,0);
        $pdf->Cell(70,2,"","TR",1,0,0,0);
        $pdf->Cell(70,10,"","L",0,0,0,0);
        $pdf->Image("public/img/logo-confaguajira.jpg", 15 ,12, 60 , 29);
        $pdf->Image('public/img/LogoSuperSubsi.png',202,190,8,60);
        $pdf->Cell(50,10,"FORMULARIO DE INSCRIPCION Y",0,0,"L",0,0);
        $pdf->Cell(70,10,"","R",1,0,0,0);
        $pdf->Cell(70,10,"","L",0,0,0,0);
        $pdf->Cell(50,1,"NOVEDADES DEL TRABAJADOR",0,0,"L",0,0);
        $pdf->Cell(70,10,"","R",1,0,0,0);
        $pdf->Cell(70,5,"","LB",0,0,0,0);
        $pdf->Image("public/img/Incontec1.jpg", 165 ,13, 15 , 20);
        $pdf->Image("public/img/Incontec2.jpg", 180 ,13, 15 , 20);
        $pdf->Cell(50,5,"","B",0,0,0,0);
        $pdf->Cell(70,5,"","BR",1,0,0,0);
        $pdf->Cell(190,5,"SM-FO-011 Version:6",0,1,"R",0,0);
        $pdf->Cell(70,1,"",0,1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','7');
        $pdf->SetTextColor(0);
        $pdf->Cell(70,1,"",0,0,0,0,0);
        $pdf->Cell(120,1,"","LTR",1,0,1,0);
        $pdf->Cell(70,4,"DILIGENCIAR FORMULARIO CON TINTA NEGRA",0,0,"L",0,0);
        $pdf->Cell(50,4,UTF8_DECODE("MARQUE CON UNA X SEGÚN EL CASO"),"L",0,"L",1,0);
        $pdf->Cell(70,4,"","R",1,0,1,0);
        $pdf->Cell(70,1,"",0,0,0,0,0);
        $pdf->Cell(55,5,"TRABAJADOR BENEFICIARIO DEL SUBSIDIO ","L",0,"L",0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(5,4,"",1,0,0,0,0);
        $pdf->Cell(50,6,"TRABAJADOR NO BENEFICIARIO ",0,0,0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(5,4,"X",1,0,0,0,0);
        $pdf->Cell(1,4,"","R",1,0,0,0);
        $pdf->Cell(70,1,"",0,0,0,0,0);
        $pdf->Cell(120,1,"","LBR",1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','10');
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->Cell(190,5,"I. TIPO DE NOVEDAD",0,1,"L",0,0);
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->Cell(190,2,"","LTR",1,0,1,0);
        $pdf->SetFont('Arial','B','8');
        $pdf->Cell(65,3,"INSCRIPCION DE TRABAJADOR","L",0,"L",1,0);
        $pdf->Cell(60,3,"AUMENTO DE PERSONAS A CARGO",0,0,"L",1,0);
        $pdf->Cell(65,3,"TRASPASO O REINTEGRO","R",1,"L",1,0);
        $pdf->Cell(55,4,"","L",0,0,0,0);
        $pdf->Cell(4,4,"X",1,0,"R",0,0);
        $pdf->Cell(50,4,"",0,0,0,0,0);
        $pdf->Cell(4,4,"",1,0,"R",0,0);
        $pdf->Cell(55,4,"","R",0,0,0,0);
        $pdf->Cell(4,4,"",1,0,"R",0,0);
        $pdf->Cell(18,4,"","R",1,0,0,0);
        $pdf->Cell(190,1,"","LRB",1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','10');
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->Cell(190,5,"II. DATOS DEL EMPLEADOR",0,1,"L",0,0);
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->SetFont('Arial','B','7');
        $pdf->Cell(40,5,"NIT:","LTR",0,"L",1,0);
        $pdf->Cell(85,5,"NOMBRE O RAZON SOCIAL","LTR",0,"L",1,0);
        $pdf->Cell(65,5,"SUCURSAL PLANILLA UNICA","LTR",1,"L",1,0);
        $pdf->Cell(40,4,"$nit","LRB",0,"C",0,0);
        while(($pdf->GetStringWidth($razsoc)-75)>0) 
        $razsoc = substr($razsoc,0,strlen($razsoc)-4)."...";
        $pdf->Cell(85,4,"$razsoc","LRB",0,"L",0,0);
        $pdf->Cell(65,4,"","LRB",1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','10');
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->Cell(190,5,"III. DATOS DEL TRABAJADOR",0,1,"L",0,0);
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->SetFont('Arial','B','8');
        $pdf->Cell(40,5,"TIPO DE DOCUMENTO","LTR",0,"L",1,0);
        $pdf->Cell(30,5,UTF8_DECODE("N° DE IDENTIDAD"),"LTR",0,"L",1,0);
        $pdf->Cell(35,5,"PRIMER APELLIDO","LTR",0,"L",1,0);
        $pdf->Cell(35,5,"SEGUNDO APELLIDO","LTR",0,"L",1,0);
        $pdf->Cell(50,5,"NOMBRE","LTR",1,"L",1,0);
        $a= "";
        if($coddoc=="1")$a="CEDULA DE CIUDADANIA";
        if($coddoc=="2")$a="TARGETA DE IDENTIDAD";
        if($coddoc=="3")$a="NIT";
        if($coddoc=="4")$a="CEDULA EXTRAGERA";
        if($coddoc=="5")$a="REGISTRO CIVIL";
        if($coddoc=="6")$a="SIN DOCUMENTO";
        if($coddoc=="7")$a="PASAPORTE";
        $pdf->Cell(40,4,$a,"LRB",0,"C",0,0);
        $pdf->Cell(30,4,"$cedtra","LRB",0,"C",0,0);
        $pdf->Cell(35,4,"$priape","LRB",0,"C",0,0);
        $pdf->Cell(35,4,"$segape","LRB",0,"C",0,0);
        $pdf->Cell(50,4,"$prinom   $segnom","LRB",1,"C",0,0);
        $pdf->Cell(47,5,"FECHA DE NACIMIENTO","LTR",0,"L",1,0);
        $pdf->Cell(22,5,"SEXO","LTR",0,"L",1,0);
        $pdf->Cell(121,5,"ESTADO CIVIL","LTR",1,"L",1,0);
        $pdf->Cell(6,4,UTF8_DECODE("AÑO"),"L",0,"L",0,0);
        $pdf->Cell(14,4,$fecnac->getYear(),0,0,"C",0,0);
        $pdf->Cell(6,4,"MES",0,"L",0,0,0);
        $pdf->Cell(7,4,$fecnac->getMonth(),0,0,"C",0,0);
        $pdf->Cell(6,4,UTF8_DECODE("DÍA"),0,0,"L",0,0);
        $pdf->Cell(8,4,$fecnac->getDay(),"R",0,"C",0,0);
        $m =  "";
        $f =  "";
        if($sexo=="M")$m="X";
        if($sexo=="F")$f="X";
        $pdf->Cell(6,4,"M","L",0,"L",0,0);
        $pdf->Cell(4,4,"$m",1,0,0,0,0);
        $pdf->Cell(6,4,"F",0,0,"L",0,0);
        $pdf->Cell(4,4,"$f",1,0,0,0,0);
        $pdf->Cell(2,6,"","R",0,0,0,0);
        $pdf->SetFont('Arial','B','7');
        $ca= "";
        $ul= "";
        $so= "";
        $vi= "";
        $se= "";
        $di= "";
        if($estciv=="2")$ca="X";
        if($estciv=="5")$ul="X";
        if($estciv=="1")$so="X";
        if($estciv=="3")$vi="X";
        if($estciv=="6")$se="X";
        if($estciv=="4")$di="X";
        $pdf->Cell(14,4,"CASADO","L",0,0,0,0);
        $pdf->Cell(4,4,$ca,1,0,0,0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(18,4,UTF8_DECODE("UNIÓN LIBRE"),0,0,0,0,0);
        $pdf->Cell(4,4,$ul,1,0,0,0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(13,4,"SOLTERO",0,0,0,0,0);
        $pdf->Cell(4,4,$so,1,0,0,0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(8,4,"VIUDO",0,0,0,0,0);
        $pdf->Cell(4,4,$vi,1,0,0,0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(15,4,"SEPARADO",0,0,0,0,0);
        $pdf->Cell(4,4,$se,1,0,0,0,0);
        $pdf->Cell(2,2,"",0,0,0,0,0);
        $pdf->Cell(17,4,"DIVORCIADO",0,0,0,0,0);
        $pdf->Cell(4,4,$di,1,0,0,0,0);
        $pdf->Cell(2,2,"","R",1,0,0,0);
        $pdf->Cell(190,3,"","LRB",1,0,0,0);
        $pdf->SetFont('Arial','B','8');
        $pdf->Cell(55,5,"FECHA DE INGRESO A LA EMPRESA","LTR",0,"L",1,0);
        $pdf->Cell(48,5,"TIPO DE CONTRATO","LTR",0,"L",1,0);
        $pdf->Cell(87,5,"JORNADA DE TRABAJO","LTR",1,"L",1,0);
        $pdf->Cell(8,5,UTF8_DECODE("AÑO"),"L",0,"C",0,0);
        $pdf->Cell(10,5,$fecing->getYear(),0,0,"C",0,0);
        $pdf->Cell(14,5,"MES",0,0,"C",0,0);
        $pdf->Cell(4,5,$fecing->getMonth(),0,0,"C",0,0);
        $pdf->Cell(14,5,UTF8_DECODE("DÍA"),0,0,"C",0,0);
        $pdf->Cell(5,5,$fecing->getDay(),"R",0,"C",0,0);
        $fi= "";
        $in= "";
        if($tipcon=="F")$fi="X";
        if($tipcon=="I")$in="X";
        $pdf->Cell(10,5,"FIJO","L",0,"C",0,0);
        $pdf->Cell(4,4,$fi,1,0,"L",0,0);
        $pdf->Cell(2,8,"",0,0,0,0,0);
        $pdf->Cell(23,5,"INDEFINIDO",0,0,"C",0,0);
        $pdf->Cell(4,4,$in,1,0,"L",0,0);
        $pdf->Cell(5,5,"","R",0,"L",0,0);
        $tc= "";
        $mt= "";
        if($horas=="240")$tc="X";
        if($horas=="120")$mt="X";
        $pdf->Cell(35,5,"MEDIO TIEMPO","L",0,"C",0,0);
        $pdf->Cell(4,4,$mt,1,0,"L",0,0);
        $pdf->Cell(2,5,"",0,0,0,0,0);
        $pdf->Cell(35,5,"TIEMPO COMPLETO",0,0,"C",0,0);
        $pdf->Cell(4,4,$tc,1,0,"L",0,0);
        $pdf->Cell(7,5,"","R",1,0,0,0);
        $pdf->Cell(190,1,"","LRB",1,0,0,0);
        $pdf->Cell(155,5,"NIVEL EDUCATIVO","LTR",0,"L",1,0);
        $pdf->Cell(35,5,UTF8_DECODE("SALARIO BÁSICO"),"LTR",1,"L",1,0);
        $pdf->SetFont('Arial','B','7');
        $tecn= "";
        $sint= "";
        $prim= "";
        $secu= "";
        $univ= "";
        if($nivedu=="I")$tecn="X";
        if($nivedu=="N")$sint="X";
        if($nivedu=="P")$prim="X";
        if($nivedu=="S")$secu="X";
        if($nivedu=="U")$univ="X";
        $pdf->Cell(18,5,"SIN ESTUDIO","L",0,"L",0,0);
        $pdf->Cell(4,4,$sint,1,0,"L",0,0);
        $pdf->Cell(15,5,"PRIMARIA",0,0,"C",0,0);
        $pdf->Cell(4,4,$prim,1,0,"L",0,0);
        $pdf->Cell(19,5,"SECUNDARIA",0,0,"C",0,0);
        $pdf->Cell(4,4,$secu,1,0,"L",0,0);
        $pdf->Cell(15,5,UTF8_DECODE("TÉCNICO"),0,0,"C",0,0);
        $pdf->Cell(4,4,$tecn,1,0,"L",0,0);
        $pdf->Cell(21,5,"UNIVERSITARIA",0,0,"C",0,0);
        $pdf->Cell(4,4,"$univ",1,0,"L",0,0);
        $pdf->Cell(12,5,"OTROS",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(10,5,"CUAL?",0,0,"C",0,0);
        $pdf->Cell(21,6,"","R",0,"L",0,0);
        $pdf->Cell(35,5,number_format($salario,0,".","."),"R",1,"C",0,0);
        $pdf->Cell(190,2,"","LRB",1,0,0,0);
        $pdf->SetFont('Arial','B','8');
        $pdf->Cell(95,5,UTF8_DECODE("DIRECCIÓN RESIDENCIA"),"LTR",0,"L",1,0);
        $pdf->Cell(42,5,UTF8_DECODE("TELÉFONO"),"LTR",0,"L",1,0);
        $pdf->Cell(53,5,"CELULAR","LTR",1,"L",1,0);
        while(($pdf->GetStringWidth($direccion)-85)>0) 
            $direccion = substr($direccion,0,strlen($direccion)-4)."...";
        $pdf->Cell(95,5,$direccion,"LRB",0,"C",0,0);
        $pdf->Cell(42,5,$telefono,"LRB",0,"C",0,0);
        $pdf->Cell(53,5,$celular,"LRB",1,"C",0,0);
        $pdf->Cell(120,5,"EMAIL","LTR",0,"L",1,0);
        $pdf->Cell(70,5,"MUNICIPIO","LTR",1,"L",1,0);
        $pdf->Cell(120,5,$email,"LRB",0,"C",0,0);
        $pdf->Cell(70,5,$ciudad[0]['detciu'],"LRB",1,"C",0,0);
        $pdf->Cell(39,5,"DEPARTAMENTO","LTR",0,"L",1,0);
        $pdf->Cell(60,5,"SECTOR","LTR",0,"L",1,0);
        $pdf->Cell(91,5,"CAPACIDAD DE TRABAJO","LTR",1,"L",1,0);
        $pdf->Cell(39,5,$depart[0]['detdep'],"LR",0,"C",0,0);
        $pdf->SetFont('Arial','B','7');
        $rur= "";
        $urbano= "";
        if($rural=="S")$rur="X";
        if($rural=="N")$urbano="X";
        $pdf->Cell(25,7,"RURAL","L",0,"C",0,0);
        $pdf->Cell(4,4,$rur,1,0,"L",0,0);
        $pdf->Cell(25,5,"URBANO",0,0,"C",0,0);
        $pdf->Cell(4,4,$urbano,1,0,"L",0,0);
        $pdf->Cell(2,7,"","R",0,"L",0,0);
        $normal= "";
        $disca= "";
        if($captra=="N")$normal="X";
        if($captra=="I")$disca="X";
        $pdf->Cell(40,5,"NORMAL","L",0,"C",0,0);
        $pdf->Cell(4,4,$normal,1,0,"L",0,0);
        $pdf->Cell(40,5,"DISCAPACITADO",0,0,"C",0,0);
        $pdf->Cell(4,4,$disca,1,0,"L",0,0);
        $pdf->Cell(3,5,"","R",1,0,0,0);
        $pdf->Cell(190,2,"","LRB",1,0,0,0);
        $pdf->SetFont('Arial','B','8');
        $pdf->Cell(140,5,"MARQUE CON UNA X LA PLAZA PARA EL GIRO DEL SUBSIDIO ","LTR",0,"L",1,0);
        $pdf->Cell(50,5,"TIPO DE VIVIENDA","LTR",1,"LTR",1,0);
        $pdf->SetFont('Arial','B','7');
        $a="";
        $e="";
        $i="";
        $o="";
        switch($tipcue){
            case '1':
                $a="X";
                break;
            case '2':
                $e="X";
                break;
            case '3':
                $i="X";
                break;
            case '4':
                $o="X";
                break;
        }
        $pdf->Cell(30,5,UTF8_DECODE("TARGETA DÉBITO"),"L",0,"C",0,0);
        $pdf->Cell(4,4,$a,1,0,"L",0,0);
        $pdf->Cell(25,5,"VILLANUEVA",0,0,"C",0,0);
        $pdf->Cell(4,4,$e,1,0,"L",0,0);
        $pdf->Cell(30,5,"EL MOLINO",0,0,"C",0,0);
        $pdf->Cell(4,4,$i,1,0,"L",0,0);
        $pdf->Cell(30,5,"URUMITA",0,0,"C",0,0);
        $pdf->Cell(4,4,$o,1,0,"L",0,0);
        $pdf->Cell(9,5,"","R",0,0,0,0);
        $famili= "";
        $propia= "";
        $arrend= "";
        $hipote= "";
        $not= "";
        if($vivienda=="F")$famili="X";
        if($vivienda=="P")$propia="X";
        if($vivienda=="A")$arrend="X";
        if($vivienda=="H")$hipote="X";
        $pdf->Cell(18,5,"FAMILIAR","L",0,"C",0,0);
        $pdf->Cell(4,4,$famili,1,0,"L",0,0);
        $pdf->Cell(18,5,"PROPIA",0,0,"C",0,0);
        $pdf->Cell(4,4,$propia,1,0,"L",0,0);
        $pdf->Cell(6,5,"","R",1,0,0,0);
        $pdf->Cell(140,5,"","LR",0,0,0,0);
        $pdf->Cell(18,5,"ARRENDADA","L",0,"C",0,0);
        $pdf->Cell(4,4,$arrend,1,0,"L",0,0);
        $pdf->Cell(18,5,"HIPOTECADA",0,0,"C",0,0);
        $pdf->Cell(4,4,$hipote,1,0,"L",0,0);
        $pdf->Cell(6,5,"","R",1,0,0,0);
        $pdf->Cell(140,1,"","LRB",0,0,0,0);
        $pdf->Cell(50,1,"","LRB",1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','10');
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->Cell(80,5,UTF8_DECODE("IV. DATOS DEL CONYUGE O COMPAÑERO (A)"),0,0,"L",0,0);
        $pdf->SetFont('Arial','B','8');
        $pdf->Cell(90,5,UTF8_DECODE("(DILIGENCIAR ÚNICAMENTE SI VA AFILIAR AL CÓNYUGE)"),0,1,"L",0,0);
        $pdf->Cell(190,1,"",0,1,0,0,0);
        $pdf->Cell(35,5,"TIPO DE DOCUMENTO","LTR",0,"L",1,0);
        $pdf->Cell(35,5,UTF8_DECODE("N° DE IDENTIDAD"),"LTR",0,"L",1,0);
        $pdf->Cell(35,5,"PRIMER APELLIDO","LTR",0,"L",1,0);
        $pdf->Cell(35,5,"SEGUNDO APELLIDO","LTR",0,"L",1,0);
        $pdf->Cell(50,5,"NOMBRE","LTR",1,"L",1,0);
        $pdf->Cell(35,4,"","LRB",0,0,0,0);
        $pdf->Cell(35,4,"","LRB",0,0,0,0);
        $pdf->Cell(35,4,"","LRB",0,0,0,0);
        $pdf->Cell(35,4,"","LRB",0,0,0,0);
        $pdf->Cell(50,4,"","LRB",1,0,0,0);
        $pdf->Cell(39,5,"FECHA DE NACIMIENTO","LTR",0,"L",1,0);
        $pdf->Cell(34,5,"INDEPENDIENTE","LTR",0,"L",1,0);
        $pdf->Cell(34,5,"TRABAJA","LTR",0,"L",1,0);
        $pdf->Cell(83,5,"ESTUDIOS","LTR",1,"L",1,0);
        $pdf->Cell(10,5,UTF8_DECODE("AÑO"),"L",0,"L",0,0);
        $pdf->Cell(3,5,"",0,0,"L",0,0);
        $pdf->Cell(10,5,"MES",0,0,"L",0,0);
        $pdf->Cell(3,5,"",0,0,"L",0,0);
        $pdf->Cell(10,5,UTF8_DECODE("DÍA"),0,0,"L",0,0);
        $pdf->Cell(3,5,"","R",0,"L",0,0);
        $pdf->Cell(9,6,"S","L",0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,0,0,0);
        $pdf->Cell(9,6,"N",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,0,0,0);
        $pdf->Cell(8,4,"","R",0,0,0,0);
        $pdf->Cell(9,6,"S","L",0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,0,0,0);
        $pdf->Cell(9,6,"N",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,0,0,0);
        $pdf->Cell(8,6,"","R",0,0,0,0);
        $pdf->SetFont('Arial','B','7');
        $pdf->Cell(21,5,"NINGUNO","L",0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(17,6,"PRIMARIA",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(19,6,"SECUNDARIA",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(14,5,"","R",1,0,0,0);
        $pdf->Cell(39,5,"","LR",0,0,0,0);
        $pdf->Cell(34,5,"","LR",0,0,0,0);
        $pdf->Cell(34,5,"","LR",0,0,0,0);
        $pdf->Cell(21,6,"PROFESIONAL",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(17,5,UTF8_DECODE("TÉCNICO"),0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(19,4,"OTROS",0,0,"C",0,0);
        $pdf->Cell(4,4,"",1,0,"L",0,0);
        $pdf->Cell(14,4,"","R",1,"L",0,0);
        $pdf->Cell(190,2,"","LRB",1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','7.8');
        $pdf->SetTextColor(24,28,202);
        $pdf->Cell(190,3,UTF8_DECODE("NOTA: DARÁN DERECHO AL SUBSIDIO FAMILIAR LAS PERSONAS A CARGO DE LOS TRABAJADORES BENEFICIARIOS TALES COMO: HIJOS,"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("HIJASTROS, HERMANOS HÚERFANOS DE PADRES Y PADRES."),0,1,"L",0,0);
        $pdf->SetTextColor(0);
        $pdf->SetFont('Arial','B','10');
        $pdf->Cell(50,8,"V. PERSONAS A CARGO",0,0,"L",0,0);
        $pdf->SetFont('Arial','B','6');
        $pdf->Cell(160,8,UTF8_DECODE("(HIJOS,HIJASTROS,HERMANOS,HUÉRFANOS DE PADRE Y PADRES)"),0,1,"L",0,0);
        $pdf->SetFont('Arial','B','7');
        $pdf->Cell(40,5,"APELLIDOS Y NOMBRES","LTR",0,"L",1,0);
        $pdf->Cell(40,5,"DOCUMENTO DE IDENTIDAD","LTRB",0,"L",1,0);
        $pdf->Cell(14,5,"SEXO","LTRB",0,"C",1,0);
        $pdf->Cell(40,5,"FECHA DE NACIMIENTO","LTRB",0,"L",1,0);
        $pdf->Cell(30,5,"PARENTESCO","LTR",0,"L",1,0);
        $pdf->Cell(25,5,"ESTUDIOS","LTR",1,"C",1,0);
        $pdf->Cell(40,5,"","LRB",0,"C",0,0);
        $pdf->Cell(10,5,"TIPO","LRB",0,"C",0,0);
        $pdf->Cell(30,5,"NUMERO","LRB",0,"C",0,0);
        $pdf->Cell(7,5,"M","LRB",0,"C",0,0);
        $pdf->Cell(7,5,"F","LRB",0,"C",0,0);
        $pdf->Cell(14,5,UTF8_DECODE("AÑO"),"LRB",0,"C",0,0);
        $pdf->Cell(13,5,"MES","LRB",0,"C",0,0);
        $pdf->Cell(13,5,UTF8_DECODE("DÍA"),"LRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LRB",0,"C",0,0);
        $pdf->Cell(25,5,"","LRB",1,"C",0,0);
        $pdf->Cell(40,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(10,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(14,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(25,5,"","LTRB",1,"C",0,0);
        $pdf->Cell(40,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(10,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(14,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(25,5,"","LTRB",1,"C",0,0);
        $pdf->Cell(40,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(10,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(14,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(25,5,"","LTRB",1,"C",0,0);
        $pdf->Cell(40,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(10,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(14,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(25,5,"","LTRB",1,"C",0,0);
        $pdf->Cell(40,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(10,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(7,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(14,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(13,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(30,5,"","LTRB",0,"C",0,0);
        $pdf->Cell(25,5,"","LTRB",1,"C",0,0);
        $pdf->Cell(190,2,"","B",1,"C",0,0);
        $pdf->Cell(190,2,"",0,1,0,0,0);
        $pdf->SetFont('Arial',"B",'7.3');
        $pdf->Cell(190,3,UTF8_DECODE("Declaro bajo gravedad de juramento que la información suministrada es veridica y autorizo a Comfaguajira a que verifique los datos aqui contenidos y "),0,1,"L",0,0);
        $pdf->Cell(190,2,UTF8_DECODE("en caso de falsedad se aplica las sanciones contempladas en la ley. "),0,1,"L",0,0);
        $pdf->Cell(190,2,"",0,1,"l",0,0);
        $pdf->Cell(190,2,"","B",1,"C",0,0);
        $pdf->Cell(190,2,"",0,1,0,0,0);
        $pdf->Cell(190,3,UTF8_DECODE("Autorizo a Comfaguajira utilizar los datos quí registrados para que sean tratados de manera confidencal, leal y transparente en los terminos y condiciones "),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("señalados en la Ley 1581 de 2012 y el decreto 1377 de 2013, para el desarrollo de campañas promocionales,oferta de servicios y programas de fidelización "),0,1,"L",0,0);
        $pdf->Cell(114,4,UTF8_DECODE("diseñadas,implementadas y administradas  por COMFAGUAJIRA o terceros autorizados, SI "),0,0,"L",0,0);
        $a="";
        $b="";
        if($autoriza=="S")$a="X";
        if($autoriza=="N")$b="X";
        $pdf->Cell(3,4,$a,"B",0,"C",0,0);
        $pdf->Cell(3,4,"","B",0,0,0,0);
        $pdf->Cell(3,4,"",0,0,0,0,0);
        $pdf->Cell(3,4,"NO",0,0,0,0,0);
        $pdf->Cell(3,4,$b,"B",1,"C",0,0);
        $pdf->Cell(0,1,"",0,1,0,0,0);
        $pdf->setX(10);
        $pdf->SetFont('Arial','B','7');
        $pdf->Cell(100,3,"FIRMA Y SELLO DE LA EMPRESA","LTR",0,"L",1,0);
        $pdf->Cell(90,3,"FECHA PARA PRIMER SUBSIDIO","LTR",1,"L",1,0);
        $pdf->Cell(100,18,"","LRB",0,"L",0,0);
        $pdf->Cell(90,18,"","LRB",1,"L",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(64,3,"FIRMA DEL TRABAJADOR","LTR",0,"L",1,0);
        $pdf->Cell(63,3,"RECIBIDO UIS","LTR",0,"L",1,0);
        $pdf->Cell(63,3,"RECIBIDO APORTES","LTR",1,"L",1,0);
        $pdf->Cell(64,18,"","LRB",0,"L",0,0);
        $pdf->Cell(63,18,"","LRB",0,"L",0,0);
        $pdf->Cell(63,18,"","LRB",1,"L",0,0);
        $pdf->Cell(190,8,UTF8_DECODE("CAUSALES DE RECHAZO O DEVOLUCIÓN DE LA AFILIACIÓN"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Que los documentos no estén completos."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Que no estén legibles,con tachones, corrector y/o enmendeduras."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Que la empresa por la cual tramita la afiliación no este afiliada."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Que el trabajador se encuentre activo por otra empresa."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Que no este totalmente diligenciado."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("Tiene derecho al subsidio familiar monetario los trabajadores cuya remuneración fija o variable no sobrepase el limite de cuatro (4) veces el salario minimo \nlegal vigente (Art.20),  que laboren diariamente mas de la mitad de la jornada máxima legal ordinaria o totalicen un minimo de noventa y seis (96) horas de labor durante el respectivo mes, y que sumados sus ingresos con los  del conyuge o compañero (a) no sobrepasen los seis (6) salarios minimos mensules legales vigentes."),0,1,"J",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,"PERSONAS A CARGO.",0,1,"L",0,0);
        $pdf->Cell(190,3,"A. Los hijos",0,1,"L",0,0);
        $pdf->Cell(190,3,"B. Los hijastros",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("C. Los hermanos huérfanos de padres"),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("D. Los padres de los trabajadores, cuando sean  mayores de sesenta (60) años, o en cualquier edad siempre y cuando se halle disminuida su capacidad de trabajo y ninguno de los dos reciba pensión o posea finca raíz. Para los efectos del regimen subsidiado familiar, se consideran personas a cargo las enumeradas, siempre y cuando convivan con el trabajador y  dependan económicamente de él.\nPara poder recibir el subsidio monetario es necesario renovar de manera manual los  certificados de escolaridad de los hijos, hijastros y hermanos huérfanos de padres, la fecha limite es hasta el 31 de marzo de cada año.\nDe igual manera,que sus hijos o hermanos cumplan 12 años, debe acreditarse la escolaridad para que continuén recibiendo el subsidio monetario.\nSolo se reconocerá retroactivo del subsidio por dos meses, a partir de la fecha de afiliación. "),0,1,"J",0);
        $pdf->Cell(190,3,"",0,1,0,0,0);
        $pdf->Cell(190,3,UTF8_DECODE("DOCUMENTOS QUE DEBEN REMITIR PARA SU INSCRIPCIÓN"),0,1,"L",0,0);
        $pdf->Cell(190,3,"TRABAJADOR SOLTERO",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Formulario de afiliación."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Copia del documento de identificación del trabajador ampliada, si es por primera vez."),0,1,"L",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("TRABAJADOR CON CÓNYUGE SIN HIJOS"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("* Formulario  de afiliación"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("* Documento de identificación del trabajador ampliada, si es por primera vez o realizar consulta a la registradurìa Nacional del Estado civil."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("* Documento de identificación del cónyuge ampliada, si es por primera vez"),0,1,"L",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("TRABAJADOR CON CÓNYUGE E HIJOS DE LA UNIÓN"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Formulario de afiliación"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del trabajador ampliada, si es por primera vez o realizar consulta a la registraduria Nacional del Estado civil."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del cónyuge, si es por primera vez"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identidad de los beneficiarios nacidos antes del mes de marzo 2004."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Manifestación del estado civil mediante formato de declaración juramentada"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Registro civil de nacimiento de los hijos para acreditar parentesco: sin autenticar, legible y no interesa la vigencia."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Certificado de estudio a partir de los 12 años."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("*Certificado del médico de entidad competente donde conste la discapacidad que le impida trabajar, indicando tipo de discapacidad: no se debe exigir porcentaje de discapacidad (solo aplica para afiliación de discapacitados)"),0,1,"J",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("TRABAJADOR CON CÓNYUGE E HIJASTROS"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Formulario de afiliación"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del trabajador, si es por primera vez o realizar consulta a la registraduria Nacional del Estado civil."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*documento de identidad de los beneficiarios nacidos antes del mes de marzo 2004."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Constancia Laboral del cónyuge o declaración de dependencia económica de los hijastros: utilizar formato de declaración juramentada."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Manifestación de unión libre: utilizar formato declaración juramentada"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Registro civil de nacimiento de los hijastros para acreditar parentesco con el padre aportante, sin autenticar, legible y no interesa la vigencia."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Certificado de estudio a partir de los 12 años."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Custodia legal emitida por la correspondiente entidad competente (ICBF, Comisaria de familiar, juzgado de familia, etc)."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("* Declaración juramentada: utilizar formato de declaración juramentada."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("*Certificado del médico de entidad competente donde conste la discapacidad que le impida trabajar, indicando tipo de discapacidad: no se debe exigir porcentaje de discapacidad (solo aplica para afiliación de discapacitados)."),0,1,"J",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Copia de la cédula de ciudadanía de la madre o el padre biológico que no estén recibiendo subsidio familiar:"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Dependencia económica: utilizar formato de declaración juramentada."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("En caso de custodia compartida, se recuerda que en virtud de lo establecido en el artículo 56 del Decreto Reglamentario 341 de 1988, la convivencia se da en relación con ambos progenitores; por lo tanto, el pago simultáneo del subsidio se calcula con base en los ingresos de los padres biológicos y se debe exigir certificación laboral de la madre o padre biológicos, según sea el caso, sobre ingresos y certificación si recibe o no subsidio por el mismo hijo."),0,1,"J",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("TRABAJADOR SOLTERO O SEPARADO CON HIJOS"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Formulario de afiliación"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del trabajador, si es por primera vez o realizar consulta a la registraduria Nacional del Estado civil."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Copia documento de identificación de la madre o padre del menor."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identidad de los beneficiarios nacidos antes del mes de marzo 2004."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Registro civil de nacimiento de los hijos para acreditar parentesco: sin autenticar, legible y no interesa la vigencia."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Certificado de estudio a partir de los 12 años."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Custodia legal emitida por la correspondiente entidad competente (ICBF, Comisaria de familiar, juzgado de familia, etc)."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Declaración juramentada preferiblemente firmada por la madre, utilizar formato de declaración juramentada."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("*Para hijos con discapacidad: certificado del médico de entidad competente donde conste la discapacidad que le impida trabajar, indicando tipo de discapacidad, no se debe exigir porcentaje de discapacidad (solo aplica para afiliación de discapacitados)."),0,1,"J",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("PADRES"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Formulario de afiliación"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del trabajador, si es por primera vez o realizar consulta a la registraduria Nacional del Estado civil."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del padre o madre, si es por primera vez."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Registro civil de nacimiento del trabajador para acreditar parentesco. Fotocopia simple, sin autenticar, legible y no interesa la vigencia."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("Manifestación de dependencia económica rendida por el padre o madre, firmado por el trabajador y padres, utilizar formato de declaración juramentada."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Certificado de EPS donde conste el tipo de afiliación."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Declaración de no recibir pensión, salario, ni renta, utilizar formato establecido por el Ministerio del Trabajo."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("* Certificado del médico de entidad competente donde conste la discapacidad que le impida trabajar, indicando tipo de discapacidad, no se debe exigir porcentaje de discapacidad (solo aplica para afiliación de discapacitados)."),0,1,"j",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("HERMANOS HUÉRFANOS DE PADRES"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Formulario de afiliación"),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Documento de identificación del trabajador, si es por primera vez o realizar consulta a la registraduria Nacional del Estado civil ."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Tarjeta de identidad de los beneficiarios nacidos antes del mes de marzo 2004."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("*Declaración juramentada donde conste la convivencia y dependencia económica del hermano huérfano de padres, con el trabajador, utilizar formato de declaración juramentada."),0,1,"J",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Registro civil de nacimiento del trabajador para acreditar parentesco: fotocopia simple, sin límite de fecha."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Registro civil de nacimiento del hermano para acreditar parentesco y edad: fotocopia simple, sin límite de fecha."),0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("*Certificado de estudio (si el niño es mayor de 12 años)."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("*Certificado del médico de entidad competente donde conste la discapacidad que le impida trabajar, indicando tipo de discapacidad, no se debe exigir porcentaje de discapacidad (solo aplica para afiliación de discapacitados)."),0,1,"J",0,0);
        $pdf->Cell(190,3,"",0,1,"L",0,0);
        $pdf->Cell(190,3,UTF8_DECODE("Cuando se trate de cambio de empleador, el trabajador deberá presentar únicamente el formulario diligenciado y fotocopia de la cedula ampliada en un 200%."),0,1,"L",0,0);
        $pdf->MultiCell(190,3,UTF8_DECODE("En caso de reintegro de trabajadores, con un tiempo de retiro inferior a seis (6) meses o traslado masivo a otro empleador, el aportante debe enviar un oficio relacionando el nombre del trabajador (es), No. del documento de identidad y fecha de reintegro. Si el trabajador tiene más de seis (6) meses de retirado de la empresa debe diligenciar un nuevo formulario y anexar fotocopia de la cedula, en caso de adición de beneficiarios debe anexar los documentos correspondientes."),0,1,"L",0,0);
        $pdf->Ln();
        $this->setResponse('view');
        ob_clean();
        $file = "public/temp/reportes/trabajador_$cedtra.pdf";
        $pdf->Output($file,"F");
        $response = parent::successFunc("Genera Formulario",$file);
        $this->renderText(json_encode($response));
        /*
           $file = "public/temp/reportes/prueba";
           $report->FinishReport($file,"F");
         */
    }

    public function addtrabajadorAction(){
        try{
            try{
                $today = new Date();
                $modelos = array("mercurio31","mercurio32","mercurio21","mercurio38");
                $Transaccion = parent::startTrans($modelos);
                $nit = $this->getPostParam("nit","addslaches","alpha","extraspaces","striptags");
                $razsoc = $this->getPostParam("razsoc","addslaches","alpha","extraspaces","striptags");
                $cedtra = $this->getPostParam("cedtra","addslaches","alpha","extraspaces","striptags");
                $coddoc = $this->getPostParam("coddoc","addslaches","alpha","extraspaces","striptags");
                $priape = $this->getPostParam("priape","addslaches","alpha","extraspaces","striptags");
                $segape = $this->getPostParam("segape","addslaches","alpha","extraspaces","striptags");
                $prinom = $this->getPostParam("prinom","addslaches","alpha","extraspaces","striptags");
                $segnom = $this->getPostParam("segnom","addslaches","alpha","extraspaces","striptags");
                $fecnac = $this->getPostParam("fecnac","addslaches","extraspaces","striptags");
                $sexo = $this->getPostParam("sexo","addslaches","alpha","extraspaces","striptags");
                $estciv = $this->getPostParam("estciv","addslaches","alpha","extraspaces","striptags");
                $codciu = $this->getPostParam("codciu","addslaches","alpha","extraspaces","striptags");
                $direccion = $this->getPostParam("direccion","addslaches","alpha","extraspaces","striptags");
                $telefono = $this->getPostParam("telefono","addslaches","alpha","extraspaces","striptags");
                $celular = $this->getPostParam("celular","addslaches","alpha","extraspaces","striptags");
                $fax = $this->getPostParam("fax","addslaches","alpha","extraspaces","striptags");
                $email = $this->getPostParam("email","addslaches","extraspaces","striptags");
                $fecing = $this->getPostParam("fecing","addslaches","extraspaces","striptags");
                $salario = $this->getPostParam("salario","addslaches","alpha","extraspaces","striptags");
                $captra = $this->getPostParam("captra","addslaches","alpha","extraspaces","striptags");
                $tipdis = $this->getPostParam("tipdis","addslaches","alpha","extraspaces","striptags");
                $nivedu = $this->getPostParam("nivedu","addslaches","alpha","extraspaces","striptags");
                $autoriza = $this->getPostParam("autoriza","addslaches","alpha","extraspaces","striptags");
                $ciunac = $this->getPostParam("ciunac","addslaches","alpha","extraspaces","striptags");
                $cabhog = $this->getPostParam("cabhog","addslaches","alpha","extraspaces","striptags");
                $codare = $this->getPostParam("codare","addslaches","alpha","extraspaces","striptags");
                $codope = $this->getPostParam("codope","addslaches","alpha","extraspaces","striptags");
                $horas = $this->getPostParam("horas","addslaches","alpha","extraspaces","striptags");
                $rural = $this->getPostParam("rural","addslaches","alpha","extraspaces","striptags");
                $tipcon = $this->getPostParam("tipcon","addslaches","alpha","extraspaces","striptags");
                $vivienda = $this->getPostParam("vivienda","addslaches","alpha","extraspaces","striptags");
                Session::setData('nota_audit',"Ingreso de Trabajador");
                $log_id = parent::registroOpcion();
                if($log_id==false){
                    parent::ErrorTrans();
                }
                $nombre = $priape." ".$segape." ".$prinom." ".$segnom;
                $mercurio31 = new Mercurio31();
                $mercurio31->setTransaction($Transaccion);
                $mercurio31->setId(0);
                $mercurio31->setLog($log_id);
                $mercurio31->setCodcaj(Session::getDATA('codcaj'));
                $mercurio31->setNit($nit);
                $mercurio31->setCedtra($cedtra);
                $mercurio31->setCoddoc($coddoc);
                $mercurio31->setPriape($priape);
                $mercurio31->setSegape($segape);
                $mercurio31->setPrinom($prinom);
                $mercurio31->setSegnom($segnom);
                $mercurio31->setFecnac($fecnac);
                $mercurio31->setSexo($sexo);
                $mercurio31->setEstciv($estciv);
                $mercurio31->setCodciu($codciu);
                $mercurio31->setDireccion($direccion);
                $mercurio31->setTelefono($telefono);
                $mercurio31->setCelular($celular);
                $mercurio31->setFax($fax);
                $mercurio31->setEmail($email);
                $mercurio31->setFecing($fecing);
                $mercurio31->setSalario($salario);
                $mercurio31->setCiunac($ciunac);
                $mercurio31->setCabhog($cabhog);
                $mercurio31->setEstado("P");
                $mercurio31->setCaptra($captra);
                $mercurio31->setTipdis($tipdis);
                $mercurio31->setNivedu($nivedu);
                $mercurio31->setAutoriza($autoriza);
                $mercurio31->setRural($rural);
                $mercurio31->setHoras($horas);
                $mercurio31->setTipcon($tipcon);
                $mercurio31->setVivienda($vivienda);
                if(!$mercurio31->save()){
                    parent::setLogger($mercurio31->getMessages());
                    parent::ErrorTrans();
                }
                $mercurio02 = $this->Mercurio02->findFirst("codcaj = '".SESSION::getDATA('codcaj')."'");
                $asunto = "Nuevo Trabajador por Aprobar $nombre";
                $msg = "Cordial Saludos<br><br>Esta pendiente por aprobar el trabajador $cedtra - $nombre con un salario de $salario de la empresa $nit - $razsoc <br><br>Atentamente,<br><br>MERCURIO";
                $ruta_file = "";
                $mercurio13 = $this->Mercurio13->find("codcaj = '".SESSION::getDATA('codcaj')."' AND codare = '$codare' AND codope = '$codope'");
                foreach($mercurio13 as $mmercurio13){
                    if(isset($_FILES['archivo_'.$mmercurio13->getCoddoc()])){
                        $_FILES["archivo_{$mmercurio13->getCoddoc()}"]['name'] = $mercurio31->getId()."_".$mmercurio13->getCoddoc()."_".$cedtra.substr($_FILES["archivo_{$mmercurio13->getCoddoc()}"]['name'],-4);
                        $path = "public/files/";
                        $this->uploadFile("archivo_{$mmercurio13->getCoddoc()}",getcwd()."/$path/");
                        $dd=pathinfo($_FILES["archivo_{$mmercurio13->getCoddoc()}"]["name"]);                     
                        $archivo_nombre = $path.$dd['basename'];                                            $ruta_file[] = $archivo_nombre;
                        $mercurio38 = new Mercurio38();
                        $mercurio38->setTransaction($Transaccion);
                        $mercurio38->setNumero($mercurio31->getId());
                        $mercurio38->setCoddoc($mmercurio13->getCoddoc());
                        $mercurio38->setNomarc($archivo_nombre);                         
                        if(!$mercurio38->save()){
                            parent::setLogger($mercurio38->getMessages());          
                            parent::ErrorTrans();
                        }
                    }
                }
                parent::finishTrans();
                $flag_email = parent::enviarCorreo("Afiliación Trabajador Mercurio",$nombre, "mercurio@syseu.com", $asunto, $msg, $ruta_file);
                if($flag_email==false){
                    return $this->redirect("principal/index/Se envio el Formulario pero sin Correo Electrónico");
                }
                $asuntotrab = "Solicitud de Afiliacion Caja";
                $msgtrab ="";
                $msgtrab .= "<p>Apreciado afiliado:</p><br/><br/>";
                $msgtrab .= "<p>Apreciado(a) ".$nombre."</p><br/><br/>";
                $msgtrab .= "<p>La solicitud de afiliacion a la {$mercurio02->getRazsoc()} se encuentra en estado pendiente por aprobacion. En breve estaremos informandole acerca del estado de su solicitud.</p><br/><br/><br/>";
               // $msgtrab .= "<p> Su afiliación ha sido aceptada a la Caja de Compensación Familiar de la Guajira,  Bienvenido a la familia COMFAGUAJIRA, familias felices. .</p><br/><br/><br/>";
                //$msgtrab .= "<p> Adjunto encontrara la carta de aceptaci&oacute;n como afiliado.</p><br/><br/><br/>";
                $msgtrab .= "<p>Atentamente,</p><br/><br/><br/>";
                $msgtrab .= "<p>Director Administrativo</p>";
                $flag_email = parent::enviarCorreo("",$nombre,$email,$asuntotrab,$msgtrab,"");
                if($flag_email==false){
                    return $this->redirect("principal/index/Se envio el formulario pero sin Correo Electrónico");
                }
                return $this->redirect("principal/index/Se registro exitosamente");
            } catch (DbException $e) {
                parent::setLogger($e->getMessage());
                parent::ErrorTrans();
            }
        } catch (TransactionFailed $e) {
            return $this->redirect("principal/index/No se pudo resgistrar");
        }

    }

    public function adjuntoAction(){
        $this->setResponse("ajax");
        $codare = $this->getPostParam("codare");
        $codope = $this->getPostParam("codope");
        $pymes = $this->getPostParam("pymes");
        $vinculo = $this->getPostParam("vinculo");
        $mercurio13 = $this->Mercurio13->find("codcaj = '".SESSION::getDATA('codcaj')."' AND codare = '$codare' AND codope='$codope'");
        $response = "";

        foreach($mercurio13 as $mmercurio13){
            $mercurio12 = $this->Mercurio12->findFirst("coddoc = '{$mmercurio13->getCoddoc()}'");

            if($mmercurio13->getCoddoc() == 3){
                if($pymes == 'S'){
                    $response .= "<tr>";
                    $response .= " <td colspan='2' style='text-align: right;'><label>Archivo {$mercurio12->getDetalle()} (pdf):</label></td>";
                    $response .= "<td colspan='2'>".Tag::fileField("archivo_{$mmercurio13->getCoddoc()}")."</td>";
                    $response .= "</tr>";
                }else{
                    continue; 
                }
            }elseif($mmercurio13->getCoddoc() == 4){
                if($vinculo == 'S'){
                    $response .= "<tr>";
                    $response .= " <td colspan='2' style='text-align: right;'><label>Archivo {$mercurio12->getDetalle()} (pdf):</label></td>";
                    $response .= "<td colspan='2'>".Tag::fileField("archivo_{$mmercurio13->getCoddoc()}")."</td>";
                    $response .= "</tr>";
                }else{
                    continue;
                }    
             }else{
                $response .= "<tr>";
                $response .= " <td colspan='2' style='text-align: right;'><label>Archivo {$mercurio12->getDetalle()} (pdf):</label></td>";
                $response .= "<td colspan='2'>".Tag::fileField("archivo_{$mmercurio13->getCoddoc()}")."</td>";
                $response .= "</tr>";
             }
        }
        $this->renderText(json_encode($response));
    }

}
?>
